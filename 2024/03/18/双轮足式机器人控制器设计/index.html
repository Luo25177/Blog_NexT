<!DOCTYPE html>
<html lang="zh-CN">
<script src="/Blog_NexT/js/snow.js"></script>
<script src="/Blog_NexT/js/forbiden.js"></script>
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/Blog_NexT/images/logo4.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/Blog_NexT/images/logo4.png">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/Blog_NexT/css/main.css">


<link rel="stylesheet" href="/Blog_NexT/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"luo25177.github.io","root":"/Blog_NexT/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="双轮足式机器人控制器设计">
<meta property="og:type" content="article">
<meta property="og:title" content="双轮足式机器人控制器设计">
<meta property="og:url" content="https://luo25177.github.io/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/index.html">
<meta property="og:site_name" content="LuosBlog">
<meta property="og:description" content="双轮足式机器人控制器设计">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709187889300.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709189277698.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709190884792.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709204006116.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709189277698.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709190884792.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709204006116.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709468855166.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709469021142.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709472773921.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1710491620264.png">
<meta property="og:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1710325439567.png">
<meta property="article:published_time" content="2024-03-18T07:51:15.000Z">
<meta property="article:modified_time" content="2025-04-02T12:23:47.845Z">
<meta property="article:author" content="落">
<meta property="article:tag" content="LQR">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luo25177.github.io/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709187889300.png">

<link rel="canonical" href="https://luo25177.github.io/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>双轮足式机器人控制器设计 | LuosBlog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/Blog_NexT/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">LuosBlog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/Blog_NexT/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-引导">

    <a href="/Blog_NexT/../" rel="section"><i class="fas fa-heart fa-fw"></i>引导</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/Blog_NexT/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/Blog_NexT/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/Blog_NexT/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/Blog_NexT/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://luo25177.github.io/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/Blog_NexT/images/avatar.png">
      <meta itemprop="name" content="落">
      <meta itemprop="description" content="茶凉言尽，月上柳梢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuosBlog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          双轮足式机器人控制器设计
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-03-18 15:51:15" itemprop="dateCreated datePublished" datetime="2024-03-18T15:51:15+08:00">2024-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-02 20:23:47" itemprop="dateModified" datetime="2025-04-02T20:23:47+08:00">2025-04-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Blog_NexT/categories/%E6%9C%BA%E5%99%A8%E4%BA%BA/" itemprop="url" rel="index"><span itemprop="name">机器人</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>36k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>33 分钟</span>
            </span>
            <div class="post-description">双轮足式机器人控制器设计</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a target="_blank" rel="noopener" href="https://github.com/Luo25177/wheelfoot">github开源仓库</a></p>
<p><strong>注意方向问题！意方向问题！方向问题！向问题！问题！题！</strong></p>
<p>机体解算时所用到的角度力矩方向都是顺时针为正（从右侧看），但是在 VMC 和腿部五连杆解算中，几乎都是逆时针为正，但是有一点，关节电机的转矩为顺时针为正，所以读者一定要注意这一点</p>
<h1 id="单侧系统状态方程求解"><a href="#单侧系统状态方程求解" class="headerlink" title="单侧系统状态方程求解"></a>单侧系统状态方程求解</h1><p>首先双轮足式机器人可以将模型化简为一个倒立摆模型，如下</p>
<p><img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709187889300.png" alt="1709187889300.png"></p>
<p>分块开始分析</p>
<h2 id="轮子"><a href="#轮子" class="headerlink" title="轮子"></a><strong>轮子</strong></h2><p><img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709189277698.png" alt="1709189277698.png"></p>
<p>水平方向上</p>
<script type="math/tex; mode=display">
m_w\ddot{x}=f-N_w</script><p>竖直方向上</p>
<script type="math/tex; mode=display">
F_N=P_w+G</script><p>转矩</p>
<script type="math/tex; mode=display">
I_w\frac{\ddot{x}}{r}=T_w-fr</script><p>联立消去 $f$ 得到</p>
<script type="math/tex; mode=display">
\ddot{x}=\frac{T_wr-N_wr^2}{I_w+m_wr^2}~~~~{1}</script><h2 id="摆杆"><a href="#摆杆" class="headerlink" title="摆杆"></a><strong>摆杆</strong></h2><p><img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709190884792.png" alt="1709190884792.png"></p>
<p>水平方向上</p>
<script type="math/tex; mode=display">
m_l(\ddot{x}+\frac{\partial^2}{\partial t^2}L_w\sin\theta)=N_w-N_b~~~~{2}</script><p>竖直方向上</p>
<script type="math/tex; mode=display">
m_l\frac{\partial^2}{\partial t^2}L_w\cos\theta=P_w-P_b-m_lg~~~~{3}</script><p>转矩</p>
<script type="math/tex; mode=display">
I_l\ddot{\theta}=T_b-T_w+(P_bL_b+P_wL_w)\sin\theta-(N_bL_b+N_wL_w)\cos\theta~~~~{4}</script><h2 id="机体"><a href="#机体" class="headerlink" title="机体"></a><strong>机体</strong></h2><p><img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709204006116.png" alt="1709204006116.png"></p>
<p>水平方向上</p>
<script type="math/tex; mode=display">
m_b(\ddot{x}+\frac{\partial^2}{\partial t^2}L\sin\theta-\frac{\partial^2}{\partial t^2}l\sin\varphi)=N_b~~~~{5}</script><p>竖直方向上</p>
<script type="math/tex; mode=display">
m_b(\frac{\partial^2}{\partial t^2}L\cos\theta+\frac{\partial^2}{\partial t^2}l\cos\varphi)=P_b-m_bg~~~~{6}</script><p>转矩</p>
<script type="math/tex; mode=display">
I_b\ddot{\varphi}=T_b+N_bl\cos\varphi+P_bl\sin\varphi~~~~{7}</script><p>根据上述得到的 ${2},{3},{5},{6}$ 联立，得到中间变量 $P_w,N_w,P_b,N_b$ 的表达式，得</p>
<script type="math/tex; mode=display">
\left\{\begin{aligned}&P_w=m_b(\frac{\partial^2}{\partial t^2}L\cos\theta+\frac{\partial^2}{\partial t^2}l\cos\varphi)+m_bg+m_l\frac{\partial^2}{\partial t^2}L_w\cos\theta+m_lg\\&N_w=m_l(\ddot{x}+\frac{\partial^2}{\partial t^2}L_w\sin\theta)+m_b(\ddot{x}+\frac{\partial^2}{\partial t^2}L\sin\theta-\frac{\partial^2}{\partial t^2}l\sin\varphi)\\&P_b=m_b(\frac{\partial^2}{\partial t^2}L\cos\theta+\frac{\partial^2}{\partial t^2}l\cos\varphi)+m_bg\\&N_b=m_b(\ddot{x}+\frac{\partial^2}{\partial t^2}L\sin\theta-\frac{\partial^2}{\partial t^2}l\sin\varphi)\end{aligned}\right.</script><p>带入 ${1},{4},{7}$ 中，并且利用 matlab 的符号求解工具解。</p>
<p>设定</p>
<script type="math/tex; mode=display">
X=\begin{bmatrix}\theta\\\dot{\theta}\\x\\\dot{x}\\\varphi\\\dot\varphi\end{bmatrix}\\U=\begin{bmatrix}T_w\\T_b\end{bmatrix}</script><p>最终求解对应的雅各比矩阵，就是 A 和 B</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">clc</span><br><span class="line">clear</span><br><span class="line">syms x(t) theta(t) phi(t)</span><br><span class="line">syms Tw Tb Pw Pb Nw Nb</span><br><span class="line">syms x_ddot theta_ddot phi_ddot x_dot theta_dot phi_dot</span><br><span class="line">syms mw R Iw mb Ib_y g Ic_z R_l l ml</span><br><span class="line">syms L Il Lw Lb</span><br><span class="line"><span class="comment">% 这里的 mw, Iw, ml, Il 都是指的是两侧的总的参数 </span></span><br><span class="line"></span><br><span class="line">func1 = [ml * diff(diff(x + Lw * <span class="built_in">sin</span>(theta), t), t) == Nw - Nb;</span><br><span class="line">    ml * diff(diff(Lw * <span class="built_in">cos</span>(theta), t), t) == Pw - Pb - ml * g;</span><br><span class="line">    mb * diff(diff(x + L * <span class="built_in">sin</span>(theta) - l * <span class="built_in">sin</span>(phi), t), t) == Nb;</span><br><span class="line">    mb * diff(diff(L * <span class="built_in">cos</span>(theta) + l * <span class="built_in">cos</span>(phi), t), t) == Pb - mb * g;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">[Pw, Pb, Nw, Nb] = solve(func1, [Pw, Pb, Nw, Nb]);</span><br><span class="line"></span><br><span class="line">func2 = [diff(diff(x, t), t) == (Tw * R - Nw * R * R) / (Iw + mw * R * R);</span><br><span class="line">    Il * diff(diff(theta, t), t) == Tb - Tw + (Pb * Lb + Pw * Lw) * <span class="built_in">sin</span>(theta) - (Nb * Lb + Nw * Lw) * <span class="built_in">cos</span>(theta);</span><br><span class="line">    Ib_y * diff(diff(phi, t), t) == Tb + Nb * l * <span class="built_in">cos</span>(phi) + Pb * l * <span class="built_in">sin</span>(phi);];</span><br><span class="line"></span><br><span class="line">func2 = subs(func2, ...</span><br><span class="line">    [diff(diff(x, t), t), diff(diff(theta, t), t), diff(diff(phi, t), t), diff(x, t), diff(theta, t), diff(phi, t)], ...</span><br><span class="line">    [x_ddot, theta_ddot, phi_ddot, x_dot, theta_dot, phi_dot]);</span><br><span class="line"></span><br><span class="line">[x_ddot, theta_ddot, phi_ddot] = solve(func2, [x_ddot theta_ddot phi_ddot]);</span><br><span class="line"></span><br><span class="line">X = [theta(t); theta_dot; x(t); x_dot; phi(t); phi_dot];</span><br><span class="line">u = [Tw; Tb];</span><br><span class="line">X_dot = [theta_dot; theta_ddot; x_dot; x_ddot; phi_dot; phi_ddot];</span><br><span class="line">A = jacobian(X_dot, X);</span><br><span class="line">B = jacobian(X_dot, u);</span><br><span class="line">A = subs(A, [x_dot, theta(t), theta_dot, phi(t), phi_dot, Tw, Tb], <span class="built_in">zeros</span>(<span class="number">1</span>,<span class="number">7</span>))</span><br><span class="line">B = subs(B, [x_dot, theta(t), theta_dot, phi(t), phi_dot, Tw, Tb], <span class="built_in">zeros</span>(<span class="number">1</span>,<span class="number">7</span>))</span><br></pre></td></tr></table></figure>
<p>最终得到结果，有点复杂，之前那个是解算出错了 T_T</p>
<p>这就是系统状态空间方程</p>
<h1 id="控制器设计"><a href="#控制器设计" class="headerlink" title="控制器设计"></a>控制器设计</h1><h2 id="LQR-控制器"><a href="#LQR-控制器" class="headerlink" title="LQR 控制器"></a>LQR 控制器</h2><p>首先是 LQR 控制器。是一个比较常用的控制器，设计起来也比较简单。</p>
<p>推导过程与一般的 LQR 无异，所以直接调用 matlab 函数来求得对应的 K，最终需要拟合出一个 K 关于杆长的函数</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% 设置</span></span><br><span class="line">C = <span class="built_in">eye</span>(<span class="number">6</span>);</span><br><span class="line">D = <span class="built_in">zeros</span>(<span class="number">6</span>,<span class="number">2</span>);</span><br><span class="line">Q = <span class="built_in">diag</span>([<span class="number">100</span> <span class="number">100</span> <span class="number">100</span> <span class="number">10</span> <span class="number">5000</span> <span class="number">1</span>]);</span><br><span class="line">R = <span class="built_in">diag</span>([<span class="number">1</span> <span class="number">0.25</span>]);</span><br><span class="line">sys = ss(A, B, C, D);</span><br><span class="line">KLQR = lqr(sys, Q, R);<span class="comment">%得到反馈增益矩阵</span></span><br></pre></td></tr></table></figure>
<p>其中的 Q 和 R 就是系统状态与系统输入的权重，越大表示越在意</p>
<p>最终需要将控制器反馈增益矩阵拟合为关于杆长的一元三次方程，具体的拟合代码为</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">clc</span><br><span class="line">clear</span><br><span class="line"><span class="comment">%% 拟合质心位置，转动惯量和杆长的函数</span></span><br><span class="line">I = <span class="built_in">zeros</span>(<span class="number">1</span>, <span class="number">116</span>);</span><br><span class="line">L = <span class="built_in">zeros</span>(<span class="number">1</span>, <span class="number">116</span>);</span><br><span class="line">Lw = <span class="built_in">zeros</span>(<span class="number">1</span>, <span class="number">116</span>);</span><br><span class="line">Lb = <span class="built_in">zeros</span>(<span class="number">1</span>, <span class="number">116</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> angle4 = <span class="number">-15</span> : <span class="number">1</span> : <span class="number">100</span></span><br><span class="line">    [ml, Il, L_, Lw_, Lb_] = GetLegBaryCenter(<span class="number">180</span> - angle4, angle4, <span class="number">0</span>);</span><br><span class="line">    I(angle4 + <span class="number">16</span>) = Il;</span><br><span class="line">    L(angle4 + <span class="number">16</span>) = L_;</span><br><span class="line">    Lw(angle4 + <span class="number">16</span>) = Lw_;</span><br><span class="line">    Lb(angle4 + <span class="number">16</span>) = Lb_;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">KI = polyfit(L, I, <span class="number">1</span>);</span><br><span class="line">valKI = polyval(KI,L);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">1</span>);<span class="built_in">hold</span> on;<span class="built_in">plot</span>(L,I,<span class="string">&#x27;r*&#x27;</span>,L,valKI,<span class="string">&#x27;b-.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">KLw = polyfit(L, Lw, <span class="number">1</span>);</span><br><span class="line">valKLw = polyval(KLw,L);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">1</span>);<span class="built_in">hold</span> on;<span class="built_in">plot</span>(L,Lw,<span class="string">&#x27;r*&#x27;</span>,L,valKLw,<span class="string">&#x27;b-.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">KLb = polyfit(L, Lb, <span class="number">1</span>);</span><br><span class="line">valKLb = polyval(KLb,L);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">1</span>);<span class="built_in">hold</span> on;<span class="built_in">plot</span>(L,Lb,<span class="string">&#x27;r*&#x27;</span>,L,valKLb,<span class="string">&#x27;b-.&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 开始解算</span></span><br><span class="line">syms x(t) theta(t) phi(t)</span><br><span class="line">syms Tw Tb Pw Pb Nw Nb</span><br><span class="line">syms x_ddot theta_ddot phi_ddot x_dot theta_dot phi_dot</span><br><span class="line">syms L</span><br><span class="line">mw = <span class="number">1.267245</span> * <span class="number">2</span>;</span><br><span class="line">R = <span class="number">0.2</span>;</span><br><span class="line">Iw = <span class="number">0.00379267</span> * <span class="number">2</span>;</span><br><span class="line">mb = <span class="number">5.4940204</span>;</span><br><span class="line">Ib_y = <span class="number">0.05026821</span>;</span><br><span class="line">g = <span class="number">9.81</span>;</span><br><span class="line">Ic_z = <span class="number">0.37248874</span>;</span><br><span class="line">R_l = <span class="number">0.482000001</span>;</span><br><span class="line">l = <span class="number">-0.01994485</span>;</span><br><span class="line">Il = (KI(<span class="number">1</span>, <span class="number">1</span>) * L + KI(<span class="number">1</span>, <span class="number">2</span>)) * <span class="number">2</span>;</span><br><span class="line">Lw = KLw(<span class="number">1</span>, <span class="number">1</span>) * L + KLw(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">Lb = KLb(<span class="number">1</span>, <span class="number">1</span>) * L + KLb(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">ml = ml * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">func1 = [ml * diff(diff(x + Lw * <span class="built_in">sin</span>(theta), t), t) == Nw - Nb;</span><br><span class="line">    ml * diff(diff(Lw * <span class="built_in">cos</span>(theta), t), t) == Pw - Pb - ml * g;</span><br><span class="line">    mb * diff(diff(x + L * <span class="built_in">sin</span>(theta) - l * <span class="built_in">sin</span>(phi), t), t) == Nb;</span><br><span class="line">    mb * diff(diff(L * <span class="built_in">cos</span>(theta) + l * <span class="built_in">cos</span>(phi), t), t) == Pb - mb * g;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">[Pw, Pb, Nw, Nb] = solve(func1, [Pw, Pb, Nw, Nb]);</span><br><span class="line"></span><br><span class="line">func2 = [diff(diff(x, t), t) == (Tw * R - Nw * R * R) / (Iw + mw * R * R);</span><br><span class="line">    Il * diff(diff(theta, t), t) == Tb - Tw + (Pb * Lb + Pw * Lw) * <span class="built_in">sin</span>(theta) - (Nb * Lb + Nw * Lw) * <span class="built_in">cos</span>(theta);</span><br><span class="line">    Ib_y * diff(diff(phi, t), t) == Tb + Nb * l * <span class="built_in">cos</span>(phi) + Pb * l * <span class="built_in">sin</span>(phi);];</span><br><span class="line"></span><br><span class="line">func2 = subs(func2, ...</span><br><span class="line">    [diff(diff(x, t), t), diff(diff(theta, t), t), diff(diff(phi, t), t), diff(x, t), diff(theta, t), diff(phi, t)], ...</span><br><span class="line">    [x_ddot, theta_ddot, phi_ddot, x_dot, theta_dot, phi_dot]);</span><br><span class="line"></span><br><span class="line">[x_ddot, theta_ddot, phi_ddot] = solve(func2, [x_ddot theta_ddot phi_ddot]);</span><br><span class="line"></span><br><span class="line">X = [theta(t); theta_dot; x(t); x_dot; phi(t); phi_dot];</span><br><span class="line">u = [Tw; Tb];</span><br><span class="line">X_dot = [theta_dot; theta_ddot; x_dot; x_ddot; phi_dot; phi_ddot];</span><br><span class="line">A = jacobian(X_dot, X);</span><br><span class="line">B = jacobian(X_dot, u);</span><br><span class="line">A = subs(A, [x_dot, theta(t), theta_dot, phi(t), phi_dot, Tw, Tb], <span class="built_in">zeros</span>(<span class="number">1</span>,<span class="number">7</span>));</span><br><span class="line">B = subs(B, [x_dot, theta(t), theta_dot, phi(t), phi_dot, Tw, Tb], <span class="built_in">zeros</span>(<span class="number">1</span>,<span class="number">7</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 设置拟合次数和腿长，开始拟合</span></span><br><span class="line">numsize = <span class="number">29</span>;</span><br><span class="line">minleglen = <span class="number">0.120</span>;</span><br><span class="line">maxleglen = <span class="number">0.400</span>;</span><br><span class="line"></span><br><span class="line">K_vals = <span class="built_in">zeros</span>(numsize, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line">A_vals = <span class="built_in">zeros</span>(numsize, <span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line">B_vals = <span class="built_in">zeros</span>(numsize, <span class="number">6</span>, <span class="number">2</span>);</span><br><span class="line">L_ranges = <span class="built_in">linspace</span>(minleglen, maxleglen, numsize);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : <span class="number">1</span> : numsize</span><br><span class="line">valL = L_ranges(<span class="built_in">i</span>);</span><br><span class="line"></span><br><span class="line">valA = subs(A, L, valL);</span><br><span class="line">valB = subs(B, L, valL);</span><br><span class="line">valA = double(valA);</span><br><span class="line">valB = double(valB);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(rank(ctrb(valA, valB)) == <span class="built_in">size</span>(valA, <span class="number">1</span>))</span><br><span class="line">    <span class="built_in">disp</span>(<span class="string">&#x27;系统可控&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">disp</span>(<span class="string">&#x27;系统不可控&#x27;</span>)</span><br><span class="line">    K = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">disp</span>(<span class="built_in">i</span>)</span><br><span class="line"></span><br><span class="line">C = <span class="built_in">eye</span>(<span class="number">6</span>);</span><br><span class="line">D = <span class="built_in">zeros</span>(<span class="number">6</span>,<span class="number">2</span>);</span><br><span class="line">Q = <span class="built_in">diag</span>([<span class="number">100</span> <span class="number">100</span> <span class="number">100</span> <span class="number">10</span> <span class="number">5000</span> <span class="number">1</span>]);</span><br><span class="line">R = <span class="built_in">diag</span>([<span class="number">1</span> <span class="number">0.25</span>]);</span><br><span class="line">sys = ss(valA, valB, C, D);</span><br><span class="line">KLQR = lqr(sys, Q, R);<span class="comment">%得到反馈增益矩阵</span></span><br><span class="line">K_vals(<span class="built_in">i</span>, :, :) = KLQR;</span><br><span class="line">A_vals(<span class="built_in">i</span>, :, :) = valA;</span><br><span class="line">B_vals(<span class="built_in">i</span>, :, :) = valB;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% LQR 拟合:比较倾向于使用Curve Fitting Toolbox，简单好用</span></span><br><span class="line">K11 = K_vals(:, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">K12 = K_vals(:, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">K13 = K_vals(:, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">K14 = K_vals(:, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">K15 = K_vals(:, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">K16 = K_vals(:, <span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">K21 = K_vals(:, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">K22 = K_vals(:, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">K23 = K_vals(:, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">K24 = K_vals(:, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">K25 = K_vals(:, <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">K26 = K_vals(:, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A11 = A_vals(:, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">A12 = A_vals(:, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">A13 = A_vals(:, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">A14 = A_vals(:, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">A15 = A_vals(:, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">A16 = A_vals(:, <span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A21 = A_vals(:, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">A22 = A_vals(:, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">A23 = A_vals(:, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">A24 = A_vals(:, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">A25 = A_vals(:, <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">A26 = A_vals(:, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A31 = A_vals(:, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">A32 = A_vals(:, <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line">A33 = A_vals(:, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">A34 = A_vals(:, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">A35 = A_vals(:, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">A36 = A_vals(:, <span class="number">3</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A41 = A_vals(:, <span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line">A42 = A_vals(:, <span class="number">4</span>, <span class="number">2</span>);</span><br><span class="line">A43 = A_vals(:, <span class="number">4</span>, <span class="number">3</span>);</span><br><span class="line">A44 = A_vals(:, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">A45 = A_vals(:, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">A46 = A_vals(:, <span class="number">4</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A51 = A_vals(:, <span class="number">5</span>, <span class="number">1</span>);</span><br><span class="line">A52 = A_vals(:, <span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line">A53 = A_vals(:, <span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line">A54 = A_vals(:, <span class="number">5</span>, <span class="number">4</span>);</span><br><span class="line">A55 = A_vals(:, <span class="number">5</span>, <span class="number">5</span>);</span><br><span class="line">A56 = A_vals(:, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A61 = A_vals(:, <span class="number">6</span>, <span class="number">1</span>);</span><br><span class="line">A62 = A_vals(:, <span class="number">6</span>, <span class="number">2</span>);</span><br><span class="line">A63 = A_vals(:, <span class="number">6</span>, <span class="number">3</span>);</span><br><span class="line">A64 = A_vals(:, <span class="number">6</span>, <span class="number">4</span>);</span><br><span class="line">A65 = A_vals(:, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line">A66 = A_vals(:, <span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">B11 = B_vals(:, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">B12 = B_vals(:, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B21 = B_vals(:, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">B22 = B_vals(:, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B31 = B_vals(:, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">B32 = B_vals(:, <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B41 = B_vals(:, <span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line">B42 = B_vals(:, <span class="number">4</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B51 = B_vals(:, <span class="number">5</span>, <span class="number">1</span>);</span><br><span class="line">B52 = B_vals(:, <span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B61 = B_vals(:, <span class="number">6</span>, <span class="number">1</span>);</span><br><span class="line">B62 = B_vals(:, <span class="number">6</span>, <span class="number">2</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>不知道为啥，喜欢上使用 Curve Fitting Toolbox 了，不想自己写代码了</p>
<h2 id="Hinfinty-控制器"><a href="#Hinfinty-控制器" class="headerlink" title="Hinfinty 控制器"></a>Hinfinty 控制器</h2><p>由于默认系统的传感器读取是没有噪声的，所以就把噪声的增益都设置为 0</p>
<p>推导过程与一般的 Hinfinty 控制器无异，所以直接放出 matlab 中的代码，可调试不同的 $\gamma$ 值来使系统有不同的表现。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">B_1 = [<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>; <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>];</span><br><span class="line">B_2 = B;</span><br><span class="line">C_1 = <span class="built_in">diag</span>([<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>]);</span><br><span class="line">D_11 = <span class="number">0</span>;</span><br><span class="line">D_12 = [<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>; <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>];</span><br><span class="line">C_2 = <span class="built_in">diag</span>([<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>]);</span><br><span class="line">D_21 = [<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>; <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>];</span><br><span class="line">D_22 = [<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>; <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>];</span><br><span class="line">syssize = <span class="built_in">size</span>(A, <span class="number">1</span>);</span><br><span class="line">inputsize = <span class="built_in">size</span>(B, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">gamma</span> = <span class="number">3.1</span>;</span><br><span class="line"></span><br><span class="line">setlmis([]);</span><br><span class="line">Xh = lmivar(<span class="number">1</span>, [syssize <span class="number">1</span>]);</span><br><span class="line">Wh = lmivar(<span class="number">2</span>, [inputsize syssize]);</span><br><span class="line">lmiterm([<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> Xh], A, <span class="number">1</span>, <span class="string">&#x27;s&#x27;</span>); <span class="comment">% AX+(AX)&#x27;</span></span><br><span class="line">lmiterm([<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> Wh], B_2, <span class="number">1</span>, <span class="string">&#x27;s&#x27;</span>); <span class="comment">%B_2W+(B_2W)&#x27;</span></span><br><span class="line">lmiterm([<span class="number">1</span> <span class="number">2</span> <span class="number">1</span> <span class="number">0</span>], B_1&#x27;); <span class="comment">% B1&#x27;</span></span><br><span class="line">lmiterm([<span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">0</span>], <span class="number">-1</span>); <span class="comment">% -I</span></span><br><span class="line">lmiterm([<span class="number">1</span> <span class="number">3</span> <span class="number">1</span> Xh], C_1, <span class="number">1</span>); <span class="comment">% C1X</span></span><br><span class="line">lmiterm([<span class="number">1</span> <span class="number">3</span> <span class="number">1</span> Wh], D_12, <span class="number">1</span>); <span class="comment">% D12W</span></span><br><span class="line">lmiterm([<span class="number">1</span> <span class="number">3</span> <span class="number">2</span> <span class="number">0</span>], D_11); <span class="comment">% D11</span></span><br><span class="line">lmiterm([<span class="number">1</span> <span class="number">3</span> <span class="number">3</span> <span class="number">0</span>], <span class="number">-1</span> * <span class="built_in">gamma</span> ^ <span class="number">2</span>); <span class="comment">% -γ^2I</span></span><br><span class="line">lmiterm([<span class="number">-2</span> <span class="number">1</span> <span class="number">1</span> Xh], <span class="number">1</span>, <span class="number">1</span>); <span class="comment">% X&gt;0 特别注意不能漏掉</span></span><br><span class="line"></span><br><span class="line">lmisys = getlmis;</span><br><span class="line">[tmin, xfeas] = feasp(lmisys);</span><br><span class="line">XX2 = dec2mat(lmisys, xfeas, Xh);</span><br><span class="line">WW2 = dec2mat(lmisys, xfeas, Wh);</span><br><span class="line">KHinfinty = WW2 * inv(XX2);</span><br></pre></td></tr></table></figure>
<h2 id="二阶-LADRC"><a href="#二阶-LADRC" class="headerlink" title="二阶 LADRC"></a>二阶 LADRC</h2><h3 id="LTD"><a href="#LTD" class="headerlink" title="LTD"></a>LTD</h3><p>这是由二阶低通滤波器来得到的，只需要更改 r 值， $r$ 值越大到达设定值 $v$ 的时间就越短</p>
<script type="math/tex; mode=display">
X=\begin{bmatrix}x_r\\\dot{x_r}\\\theta_r\\\dot{\theta_r}\\\varphi_r\\\dot\varphi_r\end{bmatrix}\\U=\begin{bmatrix}Tw\\Tb\end{bmatrix}</script><p>由于系统中状态有 6 个，所以需要 3 个低通滤波器，这里的 R 表示输入的期望值</p>
<script type="math/tex; mode=display">
\dot{X}=AX+BR=\begin{bmatrix}0&1\\-r^2_1&-2r_1\\0&1\\-r^2_2&-2r_2\\0&1\\-r^2_3&-2r_3\end{bmatrix}X+\begin{bmatrix}0\\r_1^2\\0\\r_2^2\\0\\r_3^2\end{bmatrix}R</script><p>所以得到离散型的系统状态方程</p>
<script type="math/tex; mode=display">
x_r(k+1)=h\dot{x}_r(k)+x_r(k)\\\\
\dot{x}_r(k+1)=h(-r_1^2x_r(k)-2r_1\dot{x_r}(k)+r_1^2R_{\dot x})+\dot{x_r}(k)\\\\
\theta_r(k+1)=h\dot{\theta}_r(k)+\theta_r(k)\\\\
\dot{\theta}_r(k+1)=h(-r_2^2\theta_r(k)-2r_2\dot{\theta_r}(k)+r_2^2R_{\dot\theta})+\dot{\theta_r}(k)\\\\
\varphi_r(k+1)=h\dot{\varphi}_r(k)+\varphi_r(k)\\\\
\dot{\varphi}_r(k+1)=h(-r_3^2\varphi_r(k)-2r_3\dot{\varphi_r}(k)+r_3^2R_{\dot{\varphi}})+\dot{\varphi_r}(k)</script><h3 id="LESO"><a href="#LESO" class="headerlink" title="LESO"></a>LESO</h3><p>对于每一对系统状态（$x,\dot{x}$）都需要设计一个扩张状态观测器，所以令</p>
<script type="math/tex; mode=display">
S_1=\begin{bmatrix}x_1\\x_2\\x_3\end{bmatrix}\\\\
S_2=\begin{bmatrix}\theta_1\\\theta_2\\\theta_3\end{bmatrix}\\\\
S_3=\begin{bmatrix}\varphi_1\\\varphi_2\\\varphi_3\end{bmatrix}</script><p>并且有</p>
<script type="math/tex; mode=display">
x_1\rightarrow x\\\\
x_2\rightarrow \dot{x}\\\\
x_3\rightarrow f_x\\\\
\theta_1\rightarrow \theta\\\\
\theta_2\rightarrow \dot\theta\\\\
\theta_3\rightarrow f_{\theta}\\\\
\varphi_1\rightarrow \varphi\\\\
\varphi_2\rightarrow \dot{\varphi}\\\\
\varphi_3\rightarrow f_{\varphi}</script><p>可以得到</p>
<script type="math/tex; mode=display">
\dot{Z}=AZ+Bu+L(x_1-z_1)\\\hat{y}=CZ</script><p>并且有</p>
<script type="math/tex; mode=display">
L_1=\begin{bmatrix}\beta_{11}\\\beta_{12}\\\beta_{13}\end{bmatrix}\\\\
L_2=\begin{bmatrix}\beta_{21}\\\beta_{22}\\\beta_{23}\end{bmatrix}\\\\
L_3=\begin{bmatrix}\beta_{31}\\\beta_{32}\\\beta_{33}\end{bmatrix}</script><p>带入可以得到</p>
<script type="math/tex; mode=display">
\begin{bmatrix}\dot{x_1}\\\dot{x_2}\\\dot{x_3}\end{bmatrix}=\begin{bmatrix}-\beta_{11}&1&0\\-\beta_{12}&0&1\\-\beta_{13}&0&0\end{bmatrix}\begin{bmatrix}x_1\\x_2\\x_3\end{bmatrix}+\begin{bmatrix}0&\beta_{11}\\b_1&\beta_{12}\\0&\beta_{13}\end{bmatrix}\begin{bmatrix}u\\y\end{bmatrix}\\\\
\begin{bmatrix}\dot{\theta_1}\\\dot{\theta_2}\\\dot{\theta_3}\end{bmatrix}=\begin{bmatrix}-\beta_{21}&1&0\\-\beta_{22}&0&1\\-\beta_{23}&0&0\end{bmatrix}\begin{bmatrix}\theta_1\\\theta_2\\\theta_3\end{bmatrix}+\begin{bmatrix}0&\beta_{21}\\b_2&\beta_{22}\\0&\beta_{23}\end{bmatrix}\begin{bmatrix}u\\y\end{bmatrix}\\\\
\begin{bmatrix}\dot{\varphi_1}\\\dot{\varphi_2}\\\dot{\varphi_3}\end{bmatrix}=\begin{bmatrix}-\beta_{31}&1&0\\-\beta_{32}&0&1\\-\beta_{33}&0&0\end{bmatrix}\begin{bmatrix}\varphi_1\\\varphi_2\\\varphi_3\end{bmatrix}+\begin{bmatrix}0&\beta_{31}\\b_3&\beta_{32}\\0&\beta_{33}\end{bmatrix}\begin{bmatrix}u\\y\end{bmatrix}</script><p>其中的 $\beta$ 都是存在于特征方程中</p>
<script type="math/tex; mode=display">
L_{ESO}(s)=s^{n+1}+\beta_1 s^n + \beta_2 s^{n-1}+…+\beta_{n-1}</script><p>并且可以将调节参数缩减为</p>
<script type="math/tex; mode=display">
L_{ESO1}=(s+w_{o1})^{n+1}\\\\
L_{ESO2}=(s+w_{o2})^{n+1}\\\\
L_{ESO3}=(s+w_{o3})^{n+1}</script><p>其中 $w_o$ 表示扩张观测器的带宽</p>
<p>所以上述可以写为公式，其中 $b_1,b_2, b_3\in R^{1\times2}$</p>
<script type="math/tex; mode=display">
x_1(k+1)=x_1(k)+h(-\beta_{11}x_1(k)+x_2(k)+\beta_{11}y_x)\\\\
x_2(k+1)=x_2(k)+h(-\beta_{12}x_1(k)+x_3(k)+b_1u+\beta_{12}y_x)\\\\
x_3(k+1)=x_3(k)+h(-\beta_{13}x_1(k)+\beta_{13}y_x)</script><script type="math/tex; mode=display">
\theta_1(k+1)=\theta_1(k)+h(-\beta_{21}\theta_1(k)+\theta_2(k)+\beta_{21}y_\theta)\\\\
\theta_2(k+1)=\theta_2(k)+h(-\beta_{22}\theta_1(k)+\theta_3(k)+b_2u+\beta_{22}y_\theta)\\\\
\theta_3(k+1)=\theta_3(k)+h(-\beta_{23}\theta_1(k)+\beta_{23}y_\theta)</script><script type="math/tex; mode=display">
\varphi_1(k+1)=\varphi_1(k)+h(-\beta_{31}\varphi_1(k)+\varphi_2(k)+\beta_{31}y_\varphi)\\\\
\varphi_2(k+1)=\varphi_2(k)+h(-\beta_{32}\varphi_1(k)+\varphi_3(k)+b_3u+\beta_{32}y_\varphi)\\\\
\varphi_3(k+1)=\varphi_3(k)+h(-\beta_{33}\varphi_1(k)+\beta_{33}y_\varphi)</script><h3 id="LSEF"><a href="#LSEF" class="headerlink" title="LSEF"></a>LSEF</h3><p>设</p>
<script type="math/tex; mode=display">
e_{11}=x_{r}-x_1\\\\
e_{12}=\dot{x}_r-x_2\\\\
e_{21}=\theta_{r}-\theta_1\\\\
e_{22}=\dot{\theta}_r-\theta_2\\\\
e_{31}=\varphi_{r}-\varphi_1\\\\
e_{32}=\dot{\varphi}_r-\varphi_2</script><script type="math/tex; mode=display">
T_w=\frac{a_{111}e_{11}+a_{112}e_{12}-x_3}{b_{11}}+\frac{a_{121}e_{21}+a_{122}e_{22}-\theta_3}{b_{12}}+\frac{a_{131}e_{31}+a_{132}e_{32}-\varphi_3}{b_{13}}\\\\
T_b=\frac{a_{211}e_{11}+a_{212}e_{12}-x_3}{b_{21}}+\frac{a_{221}e_{21}+a_{222}e_{22}-\theta_3}{b_{22}}+\frac{a_{231}e_{31}+a_{232}e_{32}-\varphi_3}{b_{23}}</script><p>其中 $a$ 存在于 SEF 特征方程中</p>
<script type="math/tex; mode=display">
L_{SEF}(s)=s^n+a_ns^{n-1}+…+a_2s+a_1</script><p>将特征值统一配置在左半实轴同一位置，得到</p>
<script type="math/tex; mode=display">
L_{SEF11}(s)=(s+w_{c11})^{n}\\\\
L_{SEF12}(s)=(s+w_{c12})^{n}\\\\
L_{SEF13}(s)=(s+w_{c13})^{n}\\\\
L_{SEF21}(s)=(s+w_{c21})^{n}\\\\
L_{SEF22}(s)=(s+w_{c22})^{n}\\\\
L_{SEF23}(s)=(s+w_{c23})^{n}</script><p>其中 $w_c$ 是 LSEF 的带宽</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>需要调试的参数</p>
<script type="math/tex; mode=display">
w_{o1}\\\\w_{o2}\\\\w_{o3}\\\\w_{c11}\\\\w_{c12}\\\\w_{c13}\\\\w_{c21}\\\\w_{c22}\\\\w_{c23}\\\\b_1\\\\b_2\\\\b_3</script><p>一共是 12 个参数 T_T，但是在很多系统中 $b=1$</p>
<h2 id="三阶-LADRC"><a href="#三阶-LADRC" class="headerlink" title="三阶 LADRC"></a>三阶 LADRC</h2><p>与二阶 LADRC 过程一致，所以直接得到结果</p>
<h3 id="LTD-1"><a href="#LTD-1" class="headerlink" title="LTD"></a>LTD</h3><script type="math/tex; mode=display">
x_r(k+1)=h\dot{x}_r(k)+x_r(k)\\\\
\dot{x}_r(k+1)=h\ddot{x}_r(k)+\dot{x_r}(k)\\\\
\ddot{x}_r(k+1)=h(-r_1^3x_r(k)-3r_1^2\dot{x}_r(k)-3r\ddot{x}_r(k)+r^3R_{\ddot{x}})+\dot{x_r}(k)</script><p>其它两个形式与之一致</p>
<h3 id="LESO-1"><a href="#LESO-1" class="headerlink" title="LESO"></a>LESO</h3><script type="math/tex; mode=display">
x_1(k+1)=x_1(k)+h(-\beta_{11}x_1(k)+x_2(k)+\beta_{11}y_x)\\\\
x_2(k+1)=x_2(k)+h(-\beta_{12}x_1(k)+x_3(k)+\beta_{12}y_x)\\\\
x_3(k+1)=x_3(k)+h(-\beta_{13}x_1(k)+x_4(k)+b_1u+\beta_{13}y_x)\\\\
x_4(k+1)=x_4(k)+h(-\beta_{14}x_1(k)+\beta_{14}y_x)</script><p>其它两个与之一致</p>
<h3 id="LSEF-1"><a href="#LSEF-1" class="headerlink" title="LSEF"></a>LSEF</h3><script type="math/tex; mode=display">
e_{11}=x_{r}-x_1\\\\
e_{12}=\dot{x}_r-x_2\\\\
e_{13}=\ddot{x}_r-x_3\\\\
e_{21}=\theta_{r}-\theta_1\\\\
e_{22}=\dot{\theta}_r-\theta_2\\\\
e_{23}=\ddot{\theta}_r-\theta_3\\\\
e_{31}=\varphi_{r}-\varphi_1\\\\
e_{32}=\dot{\varphi}_r-\varphi_2\\\\
e_{33}=\ddot{\varphi}_r-\varphi_3</script><script type="math/tex; mode=display">
T_w=\frac{a_{111}e_{11}+a_{112}e_{12}+a_{113}e_{13}-x_4}{b_1}+\frac{a_{121}e_{21}+a_{122}e_{22}+a_{123}e_{23}-\theta_4}{b_2}+\frac{a_{131}e_{31}+a_{132}e_{32}+a_{133}e_{33}-\varphi_4}{b_3}\\\\
T_b=\frac{a_{211}e_{11}+a_{212}e_{12}+a_{213}e_{13}-x_4}{b_1}+\frac{a_{221}e_{21}+a_{222}e_{22}+a_{223}e_{23}-\theta_4}{b_2}+\frac{a_{231}e_{31}+a_{232}e_{32}+a_{233}e_{33}-\varphi_4}{b_3}</script><h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>所需要调节的参数为</p>
<script type="math/tex; mode=display">
w_{o1}\\\\
w_{o2}\\\\
w_{o3}\\\\
w_{c11}\\\\
w_{c12}\\\\
w_{c13}\\\\
w_{c21}\\\\
w_{c22}\\\\
w_{c23}\\\\
b_1\\\\
b_2\\\\
b_3</script><p>参数的数量只与系统的输入输出数量有关，与系统的实际阶数无关</p>
<h1 id="整体状态空间方程"><a href="#整体状态空间方程" class="headerlink" title="整体状态空间方程"></a>整体状态空间方程</h1><p>与单侧的平衡状态空间方程的建立基本上是一致的，但是需要同时注意左右两侧，并且还有一些整体机器人的分析。</p>
<h2 id="轮子-1"><a href="#轮子-1" class="headerlink" title="轮子"></a><strong>轮子</strong></h2><p><img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709189277698.png" alt="1709189277698.png"></p>
<p><strong>左侧</strong></p>
<p>水平方向上</p>
<script type="math/tex; mode=display">
m_{w,l}\ddot{x}_l=f_l-N_{w,l}~~~~{1}</script><p>竖直方向上</p>
<script type="math/tex; mode=display">
F_{N,l}=P_{w,l}+G~~~~{2}</script><p>转矩</p>
<script type="math/tex; mode=display">
I_{w,l}\frac{\ddot{x}_l}{R}=T_{w,l}-f_lR~~~~{3}</script><p><strong>右侧</strong></p>
<p>水平方向上</p>
<script type="math/tex; mode=display">
m_{w,r}\ddot{x}_r=f_r-N_{w,r}~~~~{4}</script><p>竖直方向上</p>
<script type="math/tex; mode=display">
F_{N,r}=P_{w,r}+G~~~~{5}</script><p>转矩</p>
<script type="math/tex; mode=display">
I_{w,r}\frac{\ddot{x}_r}{R}=T_{w,r}-f_rR~~~~{6}</script><h2 id="摆杆-1"><a href="#摆杆-1" class="headerlink" title="摆杆"></a><strong>摆杆</strong></h2><p><img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709190884792.png" alt="1709190884792.png"></p>
<p><strong>左侧</strong></p>
<p>水平方向上</p>
<script type="math/tex; mode=display">
m_{l,l}(\ddot{x}_l+\frac{\partial^2}{\partial t^2}L_{w,l}\sin\theta_l)=N_{w,l}-N_{b,l}~~~~{7}</script><p>竖直方向上</p>
<script type="math/tex; mode=display">
m_{l,l}\frac{\partial^2}{\partial t^2}L_{w,l}\cos\theta_l=P_{w,l}-P_{b,l}-m_{l,l}g~~~~{8}</script><p>转矩</p>
<script type="math/tex; mode=display">
I_{l,l}\ddot{\theta_l}=T_{b,l}-T_{w,l}+(P_{b,l}L_{b,l}+P_{w,l}L_{w,l})\sin\theta_l-(N_{b,l}L_{b,l}+N_{w,l}L_{w,l})\cos\theta_l~~~~{9}</script><p><strong>右侧</strong></p>
<p>水平方向上</p>
<script type="math/tex; mode=display">
m_{l,r}(\ddot{x}_r+\frac{\partial^2}{\partial t^2}L_{w,r}\sin\theta_r)=N_{w,r}-N_{b,r}~~~~{10}</script><p>竖直方向上</p>
<script type="math/tex; mode=display">
m_{l,r}\frac{\partial^2}{\partial t^2}L_{w,r}\cos\theta_r=P_{w,r}-P_{b,r}-m_{l,r}g~~~~{11}</script><p>转矩</p>
<script type="math/tex; mode=display">
I_{l,r}\ddot{\theta_r}=T_{b,r}-T_{w,r}+(P_{b,r}L_{b,r}+P_{w,r}L_{w,r})\sin\theta_r-(N_{b,r}L_{b,r}+N_{w,r}L_{w,r})\cos\theta_r~~~~{12}</script><h2 id="机体-1"><a href="#机体-1" class="headerlink" title="机体"></a><strong>机体</strong></h2><p><img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709204006116.png" alt="1709204006116.png"></p>
<p>水平方向上</p>
<script type="math/tex; mode=display">
m_b\frac{\partial^2}{\partial t^2}[\frac{1}{2}({x}_l+L_l\sin\theta_l+{x}_r+L_r\sin\theta_r)-l\sin\varphi]=N_{b,l}+N_{b,r}~~~~{13}</script><p>竖直方向上</p>
<script type="math/tex; mode=display">
m_b\frac{\partial^2}{\partial t^2}[\frac{1}{2}(L_l\cos\theta_l+L_r\cos\theta_r)+l\cos\varphi]=P_{b,l}+P_{b,r}-m_bg~~~~{14}</script><p>转矩</p>
<script type="math/tex; mode=display">
I_b\ddot{\varphi}=T_{b,l}+T_{b,r}+(N_{b,l}+N_{b,r})l\cos\varphi+(P_{b,l}+P_{b,r})l\sin\varphi~~~~{15}</script><p>假设机体两侧支持力大小一致</p>
<script type="math/tex; mode=display">
P_{b,l}=P_{b,r}~~~~{16}</script><h2 id="整车的航向角"><a href="#整车的航向角" class="headerlink" title="整车的航向角"></a>整车的航向角</h2><script type="math/tex; mode=display">
I_{c,z}\ddot{\psi}=(f_r-f_l)R_l~~~~{17}\\\\
\ddot{\psi}=\frac{\partial^2}{\partial t^2}\frac{(x_r+L_r\sin\theta_r-x_l-L_l\sin\theta_l)}{2R_l}~~~~{18}</script><p>对上述中所有式子进行机体倾角进行小角度近似，然后利用其中的 ${1},{4},{7},{8},{10},{11},{13},{14},{16},{17}$ 式求解出中间变量 $P_{w,l},N_{w,l},P_{b,l},N_{b,l},P_{w,r},N_{w,r},P_{b,r},N_{b,r},f_l,f_r$ 的表达式，并且进行小角度近似（令 $\theta_l, \theta_r, \phi$ 均为 0 ）。</p>
<p>然后利用其中的 ${3},{6},{9},{12},{15}$ 来求解 $\ddot{x}_l, \ddot{x}_r, \ddot{\theta}_l,\ddot{\theta}_r,\ddot{\varphi}$ 的表达式，然后根据 ${18}$ 可以得到 $\ddot{\psi}$ 的表达式。</p>
<p>定义车子移动距离的表达式</p>
<script type="math/tex; mode=display">
s=\frac{x_l+x_r}{2}\\\\
\Downarrow\\\\
\ddot{s}=\frac{\ddot{x}_l+\ddot{x}_r}{2}</script><p>可以得到 $\ddot{s}$ 的表达式</p>
<p>定义</p>
<script type="math/tex; mode=display">
X=\begin{bmatrix}s\\\dot{s}\\\psi\\\dot{\psi}\\\theta_l\\\dot{\theta}_l\\\theta_r\\\dot{\theta}_r\\\varphi\\\dot{\varphi}\end{bmatrix}\\\\
U=\begin{bmatrix}T_{w,l}\\T_{w,r}\\T_{b,l}\\T_{b,r}\end{bmatrix}</script><p>其中 $\psi$ 为整车的航向角， $\varphi$ 为机体的俯仰角</p>
<p>最终可以得到系统状态方程的表达式。这里就不列出来了，太复杂了。直接上代码</p>
<p><strong>电脑毁灭者——未进行小角度近似</strong></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">clc</span><br><span class="line">clear</span><br><span class="line"></span><br><span class="line"><span class="comment">% 一些变量</span></span><br><span class="line">syms theta_l(t) theta_r(t) phi(t) s(t) <span class="built_in">psi</span>(t) x_l(t) x_r(t)</span><br><span class="line"><span class="comment">% 轮子参数</span></span><br><span class="line">syms mw_l mw_r f_l f_r Nw_l Nw_r Pw_l Pw_r Iw_l Iw_r R Tw_l Tw_r</span><br><span class="line"><span class="comment">% 腿部参数</span></span><br><span class="line">syms ml_l ml_r Il_l Il_r Lw_l Lw_r Lb_l Lb_r L_l L_r</span><br><span class="line"><span class="comment">% 机体参数</span></span><br><span class="line">syms mb Ib_x Ib_y Ib_z l Tb_l Tb_r Nb_l Nb_r Pb_l Pb_r</span><br><span class="line"><span class="comment">% 基本参数</span></span><br><span class="line">syms g</span><br><span class="line"><span class="comment">% 整车参数</span></span><br><span class="line">syms wb_z R_l</span><br><span class="line"><span class="comment">% 求解需要用到的</span></span><br><span class="line">syms x_l_dot x_r_dot theta_l_dot theta_r_dot phi_dot s_dot psi_dot</span><br><span class="line">syms x_l_ddot x_r_ddot theta_l_ddot theta_r_ddot phi_ddot s_ddot psi_ddot</span><br><span class="line"></span><br><span class="line"><span class="comment">% s = 0.5 * (x_l + x_r);</span></span><br><span class="line"><span class="comment">% s_dot = 0.5 * (x_l_dot + x_r_dot);</span></span><br><span class="line"><span class="comment">% s_ddot = 0.5 * (x_l_ddot + x_r_ddot);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 轮子分析</span></span><br><span class="line">xw_l = x_l;</span><br><span class="line">xw_r = x_r;</span><br><span class="line"></span><br><span class="line"><span class="comment">% 左侧 水平</span></span><br><span class="line">FrontW_l = mw_l * diff(diff(xw_l, t), t) == f_l - Nw_l;</span><br><span class="line"><span class="comment">% 左侧 转矩</span></span><br><span class="line">TorqueW_l = Iw_l * diff(diff(xw_l, t), t) / R == Tw_l - f_l * R; </span><br><span class="line"></span><br><span class="line"><span class="comment">% 右侧 水平</span></span><br><span class="line">FrontW_r = mw_r * diff(diff(xw_r, t), t) == f_r - Nw_r;</span><br><span class="line"><span class="comment">% 右侧 转矩</span></span><br><span class="line">TorqueW_r = Iw_r * diff(diff(xw_r, t), t) / R == Tw_r - f_r * R; </span><br><span class="line"></span><br><span class="line"><span class="comment">%% 腿部分析</span></span><br><span class="line">xl_l = x_l + Lw_l * <span class="built_in">sin</span>(theta_l);</span><br><span class="line">xl_r = x_r + Lw_r * <span class="built_in">sin</span>(theta_r);</span><br><span class="line">yl_l = Lw_l * <span class="built_in">cos</span>(theta_l);</span><br><span class="line">yl_r = Lw_r * <span class="built_in">cos</span>(theta_r);</span><br><span class="line"></span><br><span class="line"><span class="comment">% 左侧 水平</span></span><br><span class="line">FrontL_l = ml_l * diff(diff(xl_l, t), t) == Nw_l - Nb_l;</span><br><span class="line"><span class="comment">% 左侧 竖直</span></span><br><span class="line">UpL_l = ml_l * diff(diff(yl_l, t), t) == Pw_l - Pb_l - ml_l * g;</span><br><span class="line"><span class="comment">% 左侧 转矩</span></span><br><span class="line">TorqueL_l = Il_l * diff(diff(theta_l, t), t) == Tb_l - Tw_l + (Pb_l * Lb_l + Pw_l * Lw_l) * <span class="built_in">sin</span>(theta_l) - (Nb_l * Lb_l + Nw_l * Lw_l) * <span class="built_in">cos</span>(theta_l);</span><br><span class="line"></span><br><span class="line"><span class="comment">% 右侧 水平</span></span><br><span class="line">FrontL_r = ml_r * diff(diff(xl_r, t), t) == Nw_r - Nb_r;</span><br><span class="line"><span class="comment">% 右侧 竖直</span></span><br><span class="line">UpL_r = ml_r * diff(diff(yl_r, t), t) == Pw_r - Pb_r - ml_r * g;</span><br><span class="line"><span class="comment">% 右侧 转矩</span></span><br><span class="line">TorqueL_r = Il_r * diff(diff(theta_r, t), t) == Tb_r - Tw_r + (Pb_r * Lb_r + Pw_r * Lw_r) * <span class="built_in">sin</span>(theta_r) - (Nb_r * Lb_r + Nw_r * Lw_r) * <span class="built_in">cos</span>(theta_r);</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 机体分析</span></span><br><span class="line">xb = <span class="number">0.5</span> * (x_l + L_l * <span class="built_in">sin</span>(theta_l) + x_r + L_r * <span class="built_in">sin</span>(theta_r)) - l * <span class="built_in">sin</span>(phi);</span><br><span class="line">yb = <span class="number">0.5</span> * (L_l * <span class="built_in">cos</span>(theta_l) + L_r * <span class="built_in">cos</span>(theta_r)) + l * <span class="built_in">cos</span>(phi);</span><br><span class="line"></span><br><span class="line"><span class="comment">% 水平</span></span><br><span class="line">FrontB = mb * diff(diff(xb, t), t) == Nb_l + Nb_r;</span><br><span class="line"><span class="comment">% 竖直</span></span><br><span class="line">UpB = mb * diff(diff(yb, t), t) == Pb_l + Pb_r - mb * g;</span><br><span class="line"><span class="comment">% 转矩</span></span><br><span class="line">TorqueB = Ib_y * diff(diff(phi, t), t) == (Tb_l + Tb_r) + (Nb_l + Nb_r) * l * <span class="built_in">cos</span>(phi) + (Pb_l + Pb_r) * l * <span class="built_in">sin</span>(phi);</span><br><span class="line"><span class="comment">% 假设机体两侧支持力一致</span></span><br><span class="line">ForceEqual = Pw_l == Pw_r;</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 整车分析</span></span><br><span class="line">psi_ = (x_r - x_l + L_r * <span class="built_in">sin</span>(theta_r) - L_l * <span class="built_in">sin</span>(theta_l)) / <span class="number">2</span> / R_l;</span><br><span class="line">WholeTurn = wb_z * diff(diff(psi_, t), t) == (f_r - f_l) * R_l;</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 求解中间变量 Pw Pb Nw Nb f</span></span><br><span class="line">func1 = [FrontW_l; FrontW_r; FrontL_l; FrontL_r; UpL_l; UpL_r; FrontB; UpB; ForceEqual; WholeTurn];</span><br><span class="line">[valPw_l, valPw_r, valNw_l, valNw_r, valPb_l, valPb_r, valNb_l, valNb_r, valf_l, valf_r] = solve(func1, [Pw_l, Pw_r, Nw_l, Nw_r, Pb_l, Pb_r, Nb_l, Nb_r, f_l, f_r]);</span><br><span class="line"></span><br><span class="line">func2 = [TorqueW_l; TorqueW_r; TorqueL_l; TorqueL_r; TorqueB];</span><br><span class="line">func2 = subs(func2, ...</span><br><span class="line">    [Pw_l, Pw_r, Nw_l, Nw_r, Pb_l, Pb_r, Nb_l, Nb_r, f_l, f_r], ...</span><br><span class="line">    [valPw_l, valPw_r, valNw_l, valNw_r, valPb_l, valPb_r, valNb_l, valNb_r, valf_l, valf_r]);</span><br><span class="line"></span><br><span class="line">func2 = subs(func2, ...</span><br><span class="line">    [diff(diff(x_l, t), t), diff(diff(x_r, t), t), diff(diff(theta_l, t), t), diff(diff(theta_r, t), t), diff(diff(phi, t), t), diff(x_l, t), diff(x_r, t), diff(theta_l, t), diff(theta_r, t), diff(phi, t)], ...</span><br><span class="line">    [x_l_ddot, x_r_ddot, theta_l_ddot, theta_r_ddot, phi_ddot, x_l_dot, x_r_dot, theta_l_dot, theta_r_dot, phi_dot]);</span><br><span class="line"></span><br><span class="line">[x_l_ddot, x_r_ddot, theta_l_ddot, theta_r_ddot, phi_ddot] = vpasolve(func2, [x_l_ddot, x_r_ddot, theta_l_ddot, theta_r_ddot, phi_ddot]);</span><br><span class="line"></span><br><span class="line">X_dot = [x_l_dot, x_l_ddot, x_r_dot, x_r_ddot, theta_l_dot, theta_l_ddot, theta_r_dot, theta_r_ddot, phi_dot, phi_ddot];</span><br><span class="line">X = [x_l, x_l_dot, x_r, x_r_dot, theta_l, theta_l_dot, theta_r, theta_r_dot, phi, phi_dot];</span><br><span class="line">U = [Tw_r, Tw_r, Tb_l, Tb_r];</span><br><span class="line"></span><br><span class="line">a_25 = <span class="number">1</span> / <span class="number">2</span> * (diff(x_l_ddot, thetal_l) + diff(x_r_ddot, thetal_l));</span><br><span class="line">a_27 = <span class="number">1</span> / <span class="number">2</span> * (diff(x_l_ddot, thetal_r) + diff(x_r_ddot, thetal_r));</span><br><span class="line">a_29 = <span class="number">1</span> / <span class="number">2</span> * (diff(x_l_ddot, phi) + diff(x_r_ddot, phi));</span><br><span class="line"></span><br><span class="line">a_45 = <span class="number">1</span> / (<span class="number">2</span> * R_l) * (-diff(x_l_ddot, thetal_l) + diff(x_r_ddot, thetal_l)) - L_l / (<span class="number">2</span> * R_l) * diff(thetal_l_ddot, thetal_l) + L_r / (<span class="number">2</span> * R_l) * diff(thetal_r_ddot, thetal_l);</span><br><span class="line">a_47 = <span class="number">1</span> / (<span class="number">2</span> * R_l) * (-diff(x_l_ddot, thetal_r) + diff(x_r_ddot, thetal_r)) - L_l / (<span class="number">2</span> * R_l) * diff(thetal_l_ddot, thetal_r) + L_r / (<span class="number">2</span> * R_l) * diff(thetal_r_ddot, thetal_r);</span><br><span class="line">a_49 = <span class="number">1</span> / (<span class="number">2</span> * R_l) * (-diff(x_l_ddot, phi) + diff(x_r_ddot, phi)) - L_l / (<span class="number">2</span> * R_l) * diff(thetal_l_ddot, phi) + L_r / (<span class="number">2</span> * R_l) * diff(thetal_r_ddot, phi);</span><br><span class="line"></span><br><span class="line">a_65 = diff(thetal_l_ddot, thetal_l);</span><br><span class="line">a_67 = diff(thetal_l_ddot, thetal_r);</span><br><span class="line">a_69 = diff(thetal_l_ddot, phi);</span><br><span class="line"></span><br><span class="line">a_85 = diff(thetal_r_ddot, thetal_l);</span><br><span class="line">a_87 = diff(thetal_r_ddot, thetal_r);</span><br><span class="line">a_89 = diff(thetal_r_ddot, phi);</span><br><span class="line"></span><br><span class="line">a_x5 = diff(phi_ddot, thetal_l);</span><br><span class="line">a_x7 = diff(phi_ddot, thetal_r);</span><br><span class="line">a_x9 = diff(phi_ddot, phi);</span><br><span class="line"></span><br><span class="line">A = [<span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> a_25 <span class="number">0</span> a_27 <span class="number">0</span> a_29 <span class="number">0</span>;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> a_45 <span class="number">0</span> a_47 <span class="number">0</span> a_49 <span class="number">0</span>;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> a_65 <span class="number">0</span> a_67 <span class="number">0</span> a_69 <span class="number">0</span>;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> a_85 <span class="number">0</span> a_87 <span class="number">0</span> a_89 <span class="number">0</span>;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> a_x5 <span class="number">0</span> a_x7 <span class="number">0</span> a_x9 <span class="number">0</span>;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">b_21 = <span class="number">1</span> / <span class="number">2</span> * (diff(x_l_ddot, Tw_l) + diff(x_r_ddot, Tw_l));</span><br><span class="line">b_22 = <span class="number">1</span> / <span class="number">2</span> * (diff(x_l_ddot, Tw_r) + diff(x_r_ddot, Tw_r));</span><br><span class="line">b_23 = <span class="number">1</span> / <span class="number">2</span> * (diff(x_l_ddot, Tb_l) + diff(x_r_ddot, Tb_l));</span><br><span class="line">b_24 = <span class="number">1</span> / <span class="number">2</span> * (diff(x_l_ddot, Tb_r) + diff(x_r_ddot, Tb_r));</span><br><span class="line"></span><br><span class="line">b_41 = <span class="number">1</span> / (<span class="number">2</span> * R_l) * (-diff(x_l_ddot, Tw_l) + diff(x_r_ddot, Tw_l)) - L_l / (<span class="number">2</span> * R_l) * diff(thetal_l_ddot, Tw_l) + L_r / (<span class="number">2</span> * R_l) * diff(thetal_r_ddot, Tw_l);</span><br><span class="line">b_42 = <span class="number">1</span> / (<span class="number">2</span> * R_l) * (-diff(x_l_ddot, Tw_r) + diff(x_r_ddot, Tw_r)) - L_l / (<span class="number">2</span> * R_l) * diff(thetal_l_ddot, Tw_r) + L_r / (<span class="number">2</span> * R_l) * diff(thetal_r_ddot, Tw_r);</span><br><span class="line">b_43 = <span class="number">1</span> / (<span class="number">2</span> * R_l) * (-diff(x_l_ddot, Tb_l) + diff(x_r_ddot, Tb_l)) - L_l / (<span class="number">2</span> * R_l) * diff(thetal_l_ddot, Tb_l) + L_r / (<span class="number">2</span> * R_l) * diff(thetal_r_ddot, Tb_l);</span><br><span class="line">b_44 = <span class="number">1</span> / (<span class="number">2</span> * R_l) * (-diff(x_l_ddot, Tb_r) + diff(x_r_ddot, Tb_r)) - L_l / (<span class="number">2</span> * R_l) * diff(thetal_l_ddot, Tb_r) + L_r / (<span class="number">2</span> * R_l) * diff(thetal_r_ddot, Tb_r);</span><br><span class="line"></span><br><span class="line">b_61 = diff(thetal_l_ddot, Tw_l);</span><br><span class="line">b_62 = diff(thetal_l_ddot, Tw_r);</span><br><span class="line">b_63 = diff(thetal_l_ddot, Tb_l);</span><br><span class="line">b_64 = diff(thetal_l_ddot, Tb_r);</span><br><span class="line"></span><br><span class="line">b_81 = diff(thetal_r_ddot, Tw_l);</span><br><span class="line">b_82 = diff(thetal_r_ddot, Tw_r);</span><br><span class="line">b_83 = diff(thetal_r_ddot, Tb_l);</span><br><span class="line">b_84 = diff(thetal_r_ddot, Tb_r);</span><br><span class="line"></span><br><span class="line">b_x1 = diff(phi_ddot, Tw_l);</span><br><span class="line">b_x2 = diff(phi_ddot, Tw_r);</span><br><span class="line">b_x3 = diff(phi_ddot, Tb_l);</span><br><span class="line">b_x4 = diff(phi_ddot, Tb_r);</span><br><span class="line"></span><br><span class="line">B = [<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    b_21 b_22 b_23 b_24;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    b_41 b_42 b_43 b_44;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    b_61 b_62 b_63 b_64;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    b_81 b_82 b_83 b_84;</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    b_x1 b_x2 b_x3 b_x4;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">A = subs(A, [x_l_dot, x_r_dot, thetal_l(t), thetal_l_dot, thetal_r(t), thetal_r_dot, phi(t), phi_dot, Tw_l, Tw_r, Tb_l, Tb_r], <span class="built_in">zeros</span>(<span class="number">1</span>, <span class="number">12</span>))</span><br><span class="line">A = double(A);</span><br><span class="line">B = subs(B, [x_l_dot, x_r_dot, thetal_l(t), thetal_l_dot, thetal_r(t), thetal_r_dot, phi(t), phi_dot, Tw_l, Tw_r, Tb_l, Tb_r], <span class="built_in">zeros</span>(<span class="number">1</span>, <span class="number">12</span>))</span><br><span class="line">B = double(B);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(rank(ctrb(A, B)) == <span class="built_in">size</span>(A, <span class="number">1</span>))</span><br><span class="line">    <span class="built_in">disp</span>(<span class="string">&#x27;系统可控&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">disp</span>(<span class="string">&#x27;系统不可控&#x27;</span>)</span><br><span class="line">    K = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>上式中的符号方程不容易解，但是带入数据之后就容易解出来了。下面的解法是直接进行机体倾角小角度近似，并且提前算好中间变量</p>
<p>实际上，上述代码是根据上海交通大学所分享的开源系统设计中所得到的，主要是因为自己算出来的直接求解对应的 $jacobian$ 矩阵所得到的系统状态空间方程是不可控的，我也不知道为啥（这个解算研究两天了），验证之后发现，并不是不可控的，可能是 $jacobian$ 求解时所用的矩阵的布局不一致？把状态空间方程的最后求解的部分给改掉就好了。需要注意，上海交通大学的开源系统设计中，所用到的机体的俯仰角是右视图中是顺时针为正，与我的分析中向上抬头为正好相反。</p>
<h1 id="控制器设计-1"><a href="#控制器设计-1" class="headerlink" title="控制器设计"></a>控制器设计</h1><h2 id="LQR-控制器设计"><a href="#LQR-控制器设计" class="headerlink" title="LQR 控制器设计"></a>LQR 控制器设计</h2><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C = <span class="built_in">eye</span>(<span class="number">10</span>);</span><br><span class="line">D = <span class="built_in">zeros</span>(<span class="number">10</span>,<span class="number">4</span>);</span><br><span class="line">Q = <span class="built_in">diag</span>([<span class="number">10</span> <span class="number">1</span> <span class="number">10</span> <span class="number">1</span> <span class="number">10</span> <span class="number">10</span> <span class="number">10</span> <span class="number">10</span> <span class="number">100</span> <span class="number">1</span>]);</span><br><span class="line">R = <span class="built_in">diag</span>([<span class="number">1</span> <span class="number">1</span> <span class="number">0.25</span> <span class="number">0.25</span>]);</span><br><span class="line">sys = ss(A, B, C, D);</span><br><span class="line">K = lqr(sys, Q, R);</span><br><span class="line">K_vals(a, : , :) = K;</span><br></pre></td></tr></table></figure>
<p>其中的 Q 和 R 就是系统状态与系统输入的权重，越大表示越在意</p>
<p>最终需要将状态反馈增益系数拟合为左右杆长的二元二次函数，下面是拟合分析的总体代码</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">clc</span><br><span class="line">clear</span><br><span class="line"><span class="comment">%% 开始解算</span></span><br><span class="line">syms x(t) theta(t) phi(t)</span><br><span class="line">syms Tw Tb Pw Pb Nw Nb</span><br><span class="line">syms x_ddot theta_ddot phi_ddot x_dot theta_dot phi_dot</span><br><span class="line">syms L Il Lw Lb ml</span><br><span class="line">mw = <span class="number">1.267245</span> * <span class="number">2</span>;</span><br><span class="line">R = <span class="number">0.1</span>;</span><br><span class="line">Iw = <span class="number">0.00379267</span> * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">mb = <span class="number">5.4940204</span>;</span><br><span class="line">Ib_y = <span class="number">0.05019911</span>;</span><br><span class="line">g = <span class="number">9.81</span>;</span><br><span class="line">Ic_z = <span class="number">0.37248874</span>;</span><br><span class="line">R_l = <span class="number">0.482000001</span>;</span><br><span class="line">l = <span class="number">-0.02011323</span>;</span><br><span class="line"></span><br><span class="line">func1 = [ml * diff(diff(x + Lw * <span class="built_in">sin</span>(theta), t), t) == Nw - Nb;</span><br><span class="line">    ml * diff(diff(Lw * <span class="built_in">cos</span>(theta), t), t) == Pw - Pb - ml * g;</span><br><span class="line">    mb * diff(diff(x + L * <span class="built_in">sin</span>(theta) - l * <span class="built_in">sin</span>(phi), t), t) == Nb;</span><br><span class="line">    mb * diff(diff(L * <span class="built_in">cos</span>(theta) + l * <span class="built_in">cos</span>(phi), t), t) == Pb - mb * g;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">[Pw, Pb, Nw, Nb] = solve(func1, [Pw, Pb, Nw, Nb]);</span><br><span class="line"></span><br><span class="line">func2 = [diff(diff(x, t), t) == (Tw * R - Nw * R * R) / (Iw + mw * R * R);</span><br><span class="line">    Il * diff(diff(theta, t), t) == Tb - Tw + (Pb * Lb + Pw * Lw) * <span class="built_in">sin</span>(theta) - (Nb * Lb + Nw * Lw) * <span class="built_in">cos</span>(theta);</span><br><span class="line">    Ib_y * diff(diff(phi, t), t) == Tb + Nb * l * <span class="built_in">cos</span>(phi) + Pb * l * <span class="built_in">sin</span>(phi);];</span><br><span class="line"></span><br><span class="line">func2 = subs(func2, ...</span><br><span class="line">    [diff(diff(x, t), t), diff(diff(theta, t), t), diff(diff(phi, t), t), diff(x, t), diff(theta, t), diff(phi, t)], ...</span><br><span class="line">    [x_ddot, theta_ddot, phi_ddot, x_dot, theta_dot, phi_dot]);</span><br><span class="line"></span><br><span class="line">[x_ddot, theta_ddot, phi_ddot] = solve(func2, [x_ddot theta_ddot phi_ddot]);</span><br><span class="line"></span><br><span class="line">X = [theta(t); theta_dot; x(t); x_dot; phi(t); phi_dot];</span><br><span class="line">u = [Tw; Tb];</span><br><span class="line">X_dot = [theta_dot; theta_ddot; x_dot; x_ddot; phi_dot; phi_ddot];</span><br><span class="line">A = jacobian(X_dot, X);</span><br><span class="line">B = jacobian(X_dot, u);</span><br><span class="line">A = subs(A, [x_dot, theta(t), theta_dot, phi(t), phi_dot, Tw, Tb], <span class="built_in">zeros</span>(<span class="number">1</span>,<span class="number">7</span>));</span><br><span class="line">B = subs(B, [x_dot, theta(t), theta_dot, phi(t), phi_dot, Tw, Tb], <span class="built_in">zeros</span>(<span class="number">1</span>,<span class="number">7</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 设置拟合次数和腿长，开始拟合</span></span><br><span class="line">minangle4 = <span class="number">-15</span>;</span><br><span class="line">maxangle4 = <span class="number">79</span>;</span><br><span class="line">steps = <span class="number">0.2</span>;</span><br><span class="line">numsize = (maxangle4 - minangle4) / steps + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">K_vals = <span class="built_in">zeros</span>(numsize, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line">A_vals = <span class="built_in">zeros</span>(numsize, <span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line">B_vals = <span class="built_in">zeros</span>(numsize, <span class="number">6</span>, <span class="number">2</span>);</span><br><span class="line">L_vals = <span class="built_in">zeros</span>(numsize, <span class="number">1</span>);</span><br><span class="line">I_vals = <span class="built_in">zeros</span>(numsize, <span class="number">1</span>);</span><br><span class="line">Lw_vals = <span class="built_in">zeros</span>(numsize, <span class="number">1</span>);</span><br><span class="line">Lb_vals = <span class="built_in">zeros</span>(numsize, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">angle1_vals = <span class="built_in">zeros</span>(numsize, <span class="number">1</span>);</span><br><span class="line">angle4_vals = <span class="built_in">zeros</span>(numsize, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> angle4 = minangle4 : steps : maxangle4</span><br><span class="line">    angle1 = <span class="number">180</span> - angle4;</span><br><span class="line">    [valml, valIl, valL, valLw, valLb] = GetLegBaryCenter(angle1, angle4, <span class="number">0</span>);</span><br><span class="line">    valA = subs(A, [ml, Il, L, Lw, Lb], [<span class="number">2</span> * valml, <span class="number">2</span> * valIl, valL, valLw, valLb]);</span><br><span class="line">    valB = subs(B, [ml, Il, L, Lw, Lb], [<span class="number">2</span> * valml, <span class="number">2</span> * valIl, valL, valLw, valLb]);</span><br><span class="line">    valA = double(valA);</span><br><span class="line">    valB = double(valB);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(rank(ctrb(valA, valB)) == <span class="built_in">size</span>(valA, <span class="number">1</span>))</span><br><span class="line">        <span class="built_in">disp</span>(<span class="string">&#x27;系统可控&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">disp</span>(<span class="string">&#x27;系统不可控&#x27;</span>)</span><br><span class="line">        K = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    C = <span class="built_in">eye</span>(<span class="number">6</span>);</span><br><span class="line">    D = <span class="built_in">zeros</span>(<span class="number">6</span>,<span class="number">2</span>);</span><br><span class="line">    Q = <span class="built_in">diag</span>([<span class="number">10</span> <span class="number">1</span> <span class="number">40</span> <span class="number">30</span> <span class="number">100</span> <span class="number">1</span>]);</span><br><span class="line">    R = <span class="built_in">diag</span>([<span class="number">1</span> <span class="number">0.25</span>]);</span><br><span class="line">    sys = ss(valA, valB, C, D);</span><br><span class="line">    KLQR = lqr(sys, Q, R);<span class="comment">%得到反馈增益矩阵</span></span><br><span class="line">    K_vals(a, :, :) = KLQR;</span><br><span class="line">    A_vals(a, :, :) = valA;</span><br><span class="line">    B_vals(a, :, :) = valB;</span><br><span class="line">    L_vals(a) = valL;</span><br><span class="line">    I_vals(a) = valIl;    </span><br><span class="line">    Lb_vals(a) = valLw;</span><br><span class="line">    Lw_vals(a) = valLb;</span><br><span class="line">    </span><br><span class="line">    angle1_vals(a) = angle1;</span><br><span class="line">    angle4_vals(a) = angle4;</span><br><span class="line">    a = a + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% LQR 拟合:比较倾向于使用Curve Fitting Toolbox，简单好用</span></span><br><span class="line">K11 = K_vals(:, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">K12 = K_vals(:, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">K13 = K_vals(:, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">K14 = K_vals(:, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">K15 = K_vals(:, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">K16 = K_vals(:, <span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">K21 = K_vals(:, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">K22 = K_vals(:, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">K23 = K_vals(:, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">K24 = K_vals(:, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">K25 = K_vals(:, <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">K26 = K_vals(:, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A11 = A_vals(:, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">A12 = A_vals(:, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">A13 = A_vals(:, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">A14 = A_vals(:, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">A15 = A_vals(:, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">A16 = A_vals(:, <span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A21 = A_vals(:, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">A22 = A_vals(:, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">A23 = A_vals(:, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">A24 = A_vals(:, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">A25 = A_vals(:, <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">A26 = A_vals(:, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A31 = A_vals(:, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">A32 = A_vals(:, <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line">A33 = A_vals(:, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">A34 = A_vals(:, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">A35 = A_vals(:, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">A36 = A_vals(:, <span class="number">3</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A41 = A_vals(:, <span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line">A42 = A_vals(:, <span class="number">4</span>, <span class="number">2</span>);</span><br><span class="line">A43 = A_vals(:, <span class="number">4</span>, <span class="number">3</span>);</span><br><span class="line">A44 = A_vals(:, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">A45 = A_vals(:, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">A46 = A_vals(:, <span class="number">4</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A51 = A_vals(:, <span class="number">5</span>, <span class="number">1</span>);</span><br><span class="line">A52 = A_vals(:, <span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line">A53 = A_vals(:, <span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line">A54 = A_vals(:, <span class="number">5</span>, <span class="number">4</span>);</span><br><span class="line">A55 = A_vals(:, <span class="number">5</span>, <span class="number">5</span>);</span><br><span class="line">A56 = A_vals(:, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">A61 = A_vals(:, <span class="number">6</span>, <span class="number">1</span>);</span><br><span class="line">A62 = A_vals(:, <span class="number">6</span>, <span class="number">2</span>);</span><br><span class="line">A63 = A_vals(:, <span class="number">6</span>, <span class="number">3</span>);</span><br><span class="line">A64 = A_vals(:, <span class="number">6</span>, <span class="number">4</span>);</span><br><span class="line">A65 = A_vals(:, <span class="number">6</span>, <span class="number">5</span>);</span><br><span class="line">A66 = A_vals(:, <span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">B11 = B_vals(:, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">B12 = B_vals(:, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B21 = B_vals(:, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">B22 = B_vals(:, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B31 = B_vals(:, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">B32 = B_vals(:, <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B41 = B_vals(:, <span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line">B42 = B_vals(:, <span class="number">4</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B51 = B_vals(:, <span class="number">5</span>, <span class="number">1</span>);</span><br><span class="line">B52 = B_vals(:, <span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">B61 = B_vals(:, <span class="number">6</span>, <span class="number">1</span>);</span><br><span class="line">B62 = B_vals(:, <span class="number">6</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>获得腿部转动惯量与腿长的函数如下</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[ml, Il, L, Lw, Lb]</span> = <span class="title">GetLegBaryCenter</span><span class="params">(angle1, angle4, pitch)</span></span></span><br><span class="line"></span><br><span class="line">angle1 = angle1 / <span class="number">180</span> * <span class="built_in">pi</span>;</span><br><span class="line">angle4 = angle4 / <span class="number">180</span> * <span class="built_in">pi</span>;</span><br><span class="line"></span><br><span class="line">l1 = <span class="number">0.15</span>;</span><br><span class="line">l2 = <span class="number">0.27</span>;</span><br><span class="line">l3 = <span class="number">0.27</span>;</span><br><span class="line">l4 = <span class="number">0.15</span>;</span><br><span class="line">l5 = <span class="number">0.15</span>;</span><br><span class="line"></span><br><span class="line">ml1 = <span class="number">0.1399</span>;</span><br><span class="line">ml2 = <span class="number">0.14175</span>;</span><br><span class="line">ml3 = <span class="number">0.1779</span>;</span><br><span class="line">ml4 = <span class="number">0.10615</span>;</span><br><span class="line"></span><br><span class="line">Il1 = <span class="number">0.00057637</span>;</span><br><span class="line">Il2 = <span class="number">0.00161803</span>;</span><br><span class="line">Il3 = <span class="number">0.00204813</span>;</span><br><span class="line">Il4 = <span class="number">0.00047237</span>;</span><br><span class="line"></span><br><span class="line">scale1 = <span class="number">0.683717133</span>;</span><br><span class="line">scale2 = <span class="number">0.44485837</span>;</span><br><span class="line">scale3 = <span class="number">0.362538407</span>;</span><br><span class="line">scale4 = <span class="number">0.582931467</span>;</span><br><span class="line"></span><br><span class="line">ml = ml1 + ml2 + ml3 + ml4;</span><br><span class="line"></span><br><span class="line">xa = -l5 / <span class="number">2</span>;</span><br><span class="line">ya = <span class="number">0</span>;</span><br><span class="line">xe = l5 / <span class="number">2</span>;</span><br><span class="line">ye = <span class="number">0</span>;</span><br><span class="line">xb = l1 * <span class="built_in">cos</span>(angle1) - l5/<span class="number">2</span>;</span><br><span class="line">yb = l1 * <span class="built_in">sin</span>(angle1);</span><br><span class="line">xd = l5/<span class="number">2</span> + l4 * <span class="built_in">cos</span>(angle4);</span><br><span class="line">yd = l4 * <span class="built_in">sin</span>(angle4);</span><br><span class="line">lbd = <span class="built_in">sqrt</span>((xd - xb).^<span class="number">2</span> + (yd - yb).^<span class="number">2</span>);</span><br><span class="line">A0 = <span class="number">2</span> * l2 * (xd - xb);</span><br><span class="line">B0 = <span class="number">2</span> * l2 * (yd - yb);</span><br><span class="line">C0 = l2.^<span class="number">2</span> + lbd.^<span class="number">2</span> - l3.^<span class="number">2</span>;</span><br><span class="line">D0 = l3.^<span class="number">2</span> + lbd.^<span class="number">2</span> - l2.^<span class="number">2</span>;</span><br><span class="line">u2 = <span class="number">2</span> * <span class="built_in">atan</span>((B0 + <span class="built_in">sqrt</span>(A0.^<span class="number">2</span> + B0.^<span class="number">2</span> - C0.^<span class="number">2</span>))/(A0 + C0));</span><br><span class="line">u3 = <span class="built_in">pi</span> - <span class="number">2</span> * <span class="built_in">atan</span>((-B0 + <span class="built_in">sqrt</span>(A0.^<span class="number">2</span> + B0.^<span class="number">2</span> - D0.^<span class="number">2</span>))/(A0 + D0));</span><br><span class="line">xc = xb + l2 * <span class="built_in">cos</span>(u2);</span><br><span class="line">yc = yb + l2 * <span class="built_in">sin</span>(u2);</span><br><span class="line">R = [<span class="built_in">cos</span>(pitch), -<span class="built_in">sin</span>(pitch);</span><br><span class="line">    <span class="built_in">sin</span>(pitch), <span class="built_in">cos</span>(pitch)];</span><br><span class="line">v = R*[xc;yc];</span><br><span class="line">xc = v(<span class="number">1</span>);</span><br><span class="line">yc = v(<span class="number">2</span>);</span><br><span class="line">L = <span class="built_in">sqrt</span>(xc ^ <span class="number">2</span> + yc ^ <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">mx_l1 = scale1*(xb-xa)+xa;</span><br><span class="line">my_l1 = scale1*(yb-ya)+ya;</span><br><span class="line">mx_l2 = scale2*(xc-xb)+xb;</span><br><span class="line">my_l2 = scale2*(yc-yb)+yb;</span><br><span class="line">mx_l3 = scale3*(xc-xd)+xd;</span><br><span class="line">my_l3 = scale3*(yc-yd)+yd;</span><br><span class="line">mx_l4 = scale4*(xd-xe)+xe;</span><br><span class="line">my_l4 = scale4*(yd-ye)+ye;</span><br><span class="line"></span><br><span class="line">x = (mx_l1*ml1 + mx_l2*ml2 + mx_l3*ml3 + mx_l4*ml4)/(ml1+ml2+ml3+ml4);</span><br><span class="line">y = (my_l1*ml1 + my_l2*ml2 + my_l3*ml3 + my_l4*ml4)/(ml1+ml2+ml3+ml4);</span><br><span class="line"></span><br><span class="line">Lw = <span class="built_in">sqrt</span>((xc - x)^<span class="number">2</span> + (yc - y)^<span class="number">2</span>);</span><br><span class="line">Lb = <span class="built_in">sqrt</span>((xc)^<span class="number">2</span> + (yc)^<span class="number">2</span>);</span><br><span class="line">Lsum = Lw + Lb;</span><br><span class="line"></span><br><span class="line">Lw = Lw / Lsum * L;</span><br><span class="line">Lb = Lb / Lsum * L;</span><br><span class="line"></span><br><span class="line">x = Lb / L * xc;</span><br><span class="line">y = Lb / L * yc;</span><br><span class="line"></span><br><span class="line">d1 = <span class="built_in">sqrt</span>((x - mx_l1)^<span class="number">2</span> + (y - my_l1)^<span class="number">2</span>);</span><br><span class="line">d2 = <span class="built_in">sqrt</span>((x - mx_l2)^<span class="number">2</span> + (y - my_l2)^<span class="number">2</span>);</span><br><span class="line">d3 = <span class="built_in">sqrt</span>((x - mx_l3)^<span class="number">2</span> + (y - my_l3)^<span class="number">2</span>);</span><br><span class="line">d4 = <span class="built_in">sqrt</span>((x - mx_l4)^<span class="number">2</span> + (y - my_l4)^<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">Il = (Il1 + ml1 *d1^<span class="number">2</span>) + (Il2 + ml2 * d2^<span class="number">2</span>) + (Il3 + ml3 * d3^<span class="number">2</span>) + (Il4 + ml4 * d4^<span class="number">2</span>);<span class="comment">%平行轴定理</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><strong>代码介绍</strong></p>
<p>最上面一部分是对腿部质心，转动惯量等与腿长关系所拟合出的直线（一元一次方程），后面的 K 的拟合是利用 matlab 工具集 Curve Fitting Box 来做的。但是这个好像不能引用矩阵里面的某一块，只能直接引用一整个矩阵，所以才有了后面的一大段冗长的代码。</p>
<ol>
<li><p>在 <strong>主页-附加功能</strong> 搜索这个工具集并且下载，然后在 <strong>APP</strong> 这个界面就会有这个曲线拟合器</p>
<p> <img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709468855166.png" alt="1709468855166.png"></p>
</li>
<li><p>加载数据，并且选择对应的数据，这里的话，如果只有两个变量，y 是因变量，而三个变量的话 z 就是因变量，x 和 y 就是自变量，权重不需选择</p>
<p> <img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709469021142.png" alt="1709469021142.png"></p>
</li>
<li><p>选择自定义方程，最后拟合得到的参数就是函数的系数（右下角）</p>
<p> <img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1709472773921.png" alt="1709472773921.png"></p>
</li>
</ol>
<p>有一点不太好的是，一次只能拟合一个 K 的系数，但是还是挺简单的，而且很直观。</p>
<p>最后将这些数据写入代码中就可以了，需要注意的是 $u=-Kx$</p>
<h1 id="控制器小结"><a href="#控制器小结" class="headerlink" title="控制器小结"></a>控制器小结</h1><h2 id="半身控制器"><a href="#半身控制器" class="headerlink" title="半身控制器"></a>半身控制器</h2><p>比较简单，参数也比较少，但是需要将机体两半部分联动起来，必须要写 PID 来实现对机体整体的控制。需要额外的 PID</p>
<ul>
<li>腿部控制腿长 PID：输入当前腿长，目标腿长。输出为虚拟力。注意需要加一个前馈力，用以补偿重力和侧向惯性力矩</li>
<li>两腿夹角 PID：由于在 LQR的实际使用中，对于腿部的参数是直接使用两腿的均值，所以就会导致劈腿。所以这里需要一个防止劈腿的 PID，输入就是两腿之间的夹脚，目标为 0 ，输出就是 Tb 的增益，注意方向。</li>
<li>转向 PID：对于上述所得到的 LQR 控制器，发现并没有关于转向的 PID，所以需要自己写一个，输入就是当前转角，目标为目标角度，输出就是 Tw 的增益。注意方向</li>
<li>翻滚角 PID：用于控制机体的翻滚角，输入系统当前翻滚角，目标翻滚角，输出就是虚拟力 F 的增益。注意方向</li>
</ul>
<h2 id="全身控制器"><a href="#全身控制器" class="headerlink" title="全身控制器"></a>全身控制器</h2><p>比较复杂，系统状态空间方程会很难解算，只能说自己解了好久（2天，对应上面的半身控制器只用了一个小时），参数巨多，最终拟合出来的 K 的函数至少有 240 个参数，我只能说太魔鬼了。但是实际控制效果还是很不错的，需要的额外 PID 并不是很多，其实也不少</p>
<ul>
<li>腿部控制腿长 PID：输入当前腿长，目标腿长。输出为虚拟力。注意需要加一个前馈力，用以补偿重力和侧向惯性力矩</li>
<li>翻滚角 PID：用于控制机体的翻滚角，输入系统当前翻滚角，目标翻滚角，输出就是虚拟力 F 的增益。注意方向</li>
<li>两腿夹角 PID：由于在 LQR的实际使用中，对于腿部的参数是直接使用两腿的均值，所以就会导致劈腿。所以这里需要一个防止劈腿的 PID，输入就是两腿之间的夹脚，目标为 0 ，输出就是 Tb 的增益，注意方向。</li>
</ul>
<h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><p>全身控制器相比半身控制器会更复杂，但是对系统的控制效果说实话还是很不错的，感觉控制的很细腻（不知道是不是好不容易解出来之后对自己的安慰）。可以都试试。</p>
<p>对于 ADRC 和 Hinfinty 控制器，并不是很好用，ADRC 来说，需要调试的参数太多，而且系统耦合性太强了，很不好调，而且也很复杂，主要是编程要写的太多了（doge）。Hinfinty 来说，也不需要调节参数，实际上只有一个 $\gamma$ 需要调节，但是最终的效果不尽人意啊，抖动太大，而且对于干扰的抗性并不是很好（也许是自己做的问题）。</p>
<p>但是不管怎么说，LQR 还算是一个不错的控制器的</p>
<p>在仿真中测试，WBC 是比单边控制要有更高的上限，并且对机体的控制确实更好。但是也需要控制腿部夹角</p>
<h1 id="五连杆正运动学解算"><a href="#五连杆正运动学解算" class="headerlink" title="五连杆正运动学解算"></a>五连杆正运动学解算</h1><p><img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1710491620264.png" alt="1710491620264.png"></p>
<p>以杆 $L_5$ 的中心为原点，可以得到</p>
<script type="math/tex; mode=display">
A=(-\frac{L_5}{2}, 0)\\\\
B=(-\frac{L_5}{2}+L_1\cos\varphi_1,L_1\sin\varphi_1)\\\\
D=(\frac{L_5}{2}+L_4\cos\varphi_4,L_4\sin\varphi_4)\\\\
E=(\frac{L_5}{2},0)</script><p>通过五连杆左右两部分列写 C 点坐标，可以得到下列等式</p>
<script type="math/tex; mode=display">
\left\{\begin{aligned}&x_B+L_2\cos\varphi_2=x_D+L_3\cos\varphi_3\\&y_B+L_2\sin\varphi_2=y_D+L_3\sin\varphi_3\end{aligned}\right.</script><p>求解得到</p>
<script type="math/tex; mode=display">
\varphi_2=2\arctan(\frac{B+\sqrt{A^2+B^2-C^2}}{A+C})\\\\
\varphi_3=\pi-2\arctan(\frac{-B+\sqrt{A^2+B^2-D^2}}{A+D})</script><p>其中</p>
<script type="math/tex; mode=display">
A=2L_2(x_D-x_B)\\\\
B=2L_2(y_D-y_B)\\\\
C=L_2^2+L_{BD}^2-L_3^2\\\\
D=L_3^2+L_{BD}^2-L_2^2\\\\
L_{BD}=\sqrt{(x_D-x_B)^2+(y_D-y_B)^2}</script><p>可以得到 C 点坐标</p>
<script type="math/tex; mode=display">
x_C=-\frac{L_5}{2}+L_1\cos(\varphi_1)+L_2\cos(\varphi_2)\\\\
y_C=L_1\sin(\varphi_1)+L_2\sin(\varphi_2)</script><p>则</p>
<script type="math/tex; mode=display">
L_0=\sqrt{x_c^2+y_c^2}\\\\
\varphi_0=\arctan{\frac{y_c}{x_c}}</script><h1 id="VMC"><a href="#VMC" class="headerlink" title="VMC"></a>VMC</h1><p>关键是在每个需要控制的自由度上构造合适的虚拟构件来产生合适的虚拟力。虚拟力不是实际执行机构的作用力或力矩，而是通过执行机构的作用经过机构转换而成。对于一些控制问题，我们可能需要将工作空间 (Task Space) 的力或力矩映射成关节空间 (Joint Space) 的关节力矩。</p>
<p>在五连杆中，需要获得机构末端沿腿的推力 $F$ 与沿中心轴的力矩 $T_b$，对应极坐标 $L_0,\varphi_0$ 与 $A,E$ 两个关节转动副力矩 $T_A,T_E$ 的关系。所以定义</p>
<script type="math/tex; mode=display">
x=\begin{bmatrix}L_0\\\varphi_0\end{bmatrix}\\\\
q=\begin{bmatrix}\varphi_1\\\varphi_4\end{bmatrix}</script><p>对正运动学模型 $x=f(q)$ 做微分得</p>
<script type="math/tex; mode=display">
f'=\begin{bmatrix}\frac{\partial L_0}{\partial \varphi_1}&\frac{\partial L_0}{\partial \varphi_4}\\\frac{\partial \varphi_0}{\partial \varphi_1}&\frac{\partial \varphi_0}{\partial \varphi_4}\end{bmatrix}</script><p>这就是 x 对 q 的雅各比矩阵，记作 $J$。得到对应的全微分方程为</p>
<script type="math/tex; mode=display">
\Delta x=J\Delta q</script><p>通过雅各比矩阵 $J$ 将关节速度 $\dot{q}$ 映射为五连杆姿态变化率 $\dot{x}$。根据虚功原理，可以得到</p>
<script type="math/tex; mode=display">
T^T\Delta q+(-F)^T\Delta x=0\\\\
\Downarrow\\\\
T=\begin{bmatrix}T_A\\T_E\end{bmatrix}\\F_{pole}=\begin{bmatrix}F\\T_b\end{bmatrix}</script><p>将全微分方程带入之后可得</p>
<script type="math/tex; mode=display">
T=J^TF_{pole}</script><p>但是上述推导中的正运动学模型直接求雅各比矩阵比较困难，因为模型中有大量的平方与三角函数的运算，结果比较复杂。所以进行下列改进</p>
<p>由于雅各比矩阵实际上描述的是两坐标微分的线性映射关系，所以可以计算速度映射来得到雅各比矩阵。由于 $L_0,\varphi_0$ 实际上就是 $C$ 点的极坐标，所以首先求出 $C$ 点直角坐标速度</p>
<script type="math/tex; mode=display">
\dot{x}_C=-L_1\dot{\varphi}_1\sin\varphi_1-L_2\dot{\varphi}_2\sin\varphi_2\\\\
\dot{y}_C=L_1\dot{\varphi}_1\cos\varphi_1+L_2\dot{\varphi}_2\cos\varphi_2</script><p>通过五连杆左右两部分列写 C 点坐标求导可以得到 $\dot\varphi_2$</p>
<script type="math/tex; mode=display">
\left\{\begin{aligned}&\dot x_B-L_2\dot\varphi_2\sin\varphi_2=\dot x_D-L_3\dot\varphi_3\sin\varphi_3\\&y_B+L_2\sin\varphi_2=y_D+L_3\sin\varphi_3\end{aligned}\right.</script><p>消去 $\dot\varphi_3$ 得到 $\dot\varphi_2$</p>
<script type="math/tex; mode=display">
\dot\varphi_2=\frac{(\dot x_D-\dot x_B)\cos\varphi_3+(\dot y_D-\dot y_B)\sin\varphi_3}{L_2\sin(\varphi_3-\varphi_2)}</script><p>其中</p>
<script type="math/tex; mode=display">
\dot x_B=-L_2\dot\varphi_1\sin\varphi_1\\\\
\dot y_B=L_2\dot\varphi_1\cos\varphi_1\\\\
\dot x_D=-L_4\dot\varphi_4\sin\varphi_4\\\\
\dot y_D=L_4\dot\varphi_4\sin\varphi_4</script><p>并且其中的 $\dot\varphi_1,\dot\varphi_4$ 都是直接测出来的，带入之后得到</p>
<script type="math/tex; mode=display">
\dot{x}_C=-L_1\dot{\varphi}_1\sin\varphi_1-L_2\frac{(\dot x_D-\dot x_B)\cos\varphi_3+(\dot y_D-\dot y_B)\sin\varphi_3}{L_2\sin(\varphi_3-\varphi_2)}\sin\varphi_2\\\\
\dot{y}_C=L_1\dot{\varphi}_1\cos\varphi_1+L_2\frac{(\dot x_D-\dot x_B)\cos\varphi_3+(\dot y_D-\dot y_B)\sin\varphi_3}{L_2\sin(\varphi_3-\varphi_2)}\cos\varphi_2</script><p>化简之后得到</p>
<script type="math/tex; mode=display">
\begin{bmatrix}\dot x_C\\\dot y_C\end{bmatrix}=\begin{bmatrix}\frac{L_1\sin(\varphi_1-\varphi_2)\sin\varphi_3}{\sin(\varphi_2-\varphi_3)}&\frac{L_4\sin(\varphi_3-\varphi_4)\sin\varphi_2}{\sin(\varphi_2-\varphi_3)}\\-\frac{L_1\sin(\varphi_1-\varphi_2)\cos\varphi_3}{\sin(\varphi_2-\varphi_3)}&-\frac{L_4\sin(\varphi_3-\varphi_4)\cos\varphi_2}{\sin(\varphi_2-\varphi_3)}\end{bmatrix}\begin{bmatrix}\dot \varphi_1\\\dot \varphi_4\end{bmatrix}</script><p>记作</p>
<script type="math/tex; mode=display">
\begin{bmatrix}\dot x_C\\\dot y_C\end{bmatrix}=J\begin{bmatrix}\dot \varphi_1\\\dot \varphi_4\end{bmatrix}</script><p>根据上式可以得到关节力矩 $T$ 与虚拟力 $F_{rect}$ 的关系</p>
<script type="math/tex; mode=display">
T=J^TF_{rect}\\F_{rect}=\begin{bmatrix}F_x\\F_y\end{bmatrix}</script><p>利用旋转矩阵将 $F_{rect}$ 旋转到杆的方向，旋转矩阵记作 $R$</p>
<script type="math/tex; mode=display">
\begin{bmatrix}F_x\\F_y\end{bmatrix}=\begin{bmatrix}\cos\theta&\sin\theta\\-\sin\theta&\cos\theta\end{bmatrix}\begin{bmatrix}F_c\\F_t\end{bmatrix}</script><p>将杆的方向里转到极坐标方向的力 $F_{pole}$，旋转矩阵记作 $M$</p>
<script type="math/tex; mode=display">
\begin{bmatrix}F_c\\F_t\end{bmatrix}=\begin{bmatrix}0&\frac{1}{L_0}\\1&0\end{bmatrix}\begin{bmatrix}F\\T_b\end{bmatrix}</script><p>依次带入得到最终的关节力矩与虚拟力之间的映射关系</p>
<script type="math/tex; mode=display">
T=J^TRMF_{pole}</script><p>令</p>
<script type="math/tex; mode=display">
A=\frac{L_1\sin(\varphi_1-\varphi_2)}{\sin(\varphi_2-\varphi_3)}\\B=\frac{L_4\sin(\varphi_3-\varphi_4)}{\sin(\varphi_2-\varphi_3)}</script><p>最终带入得到</p>
<script type="math/tex; mode=display">
T=\begin{bmatrix}-A\cos(\theta+\varphi_3)&\frac{A\sin(\theta+\varphi_3)}{L_0}\\-B\cos(\theta+\varphi_2)&\frac{B\sin(\theta+\varphi_2)}{L_0}\end{bmatrix}F_{pole}</script><p>但是在这里解算中的 $\varphi_0,\varphi_1,\varphi_2,\varphi_3, \varphi_4$ 都是逆时针为正的，所以最终得到的 $T$ 也是逆时针的，要施加到电机上需要取负值，因此最终结果为</p>
<script type="math/tex; mode=display">
T=\begin{bmatrix}A\cos(\theta+\varphi_3)&-\frac{A\sin(\theta+\varphi_3)}{L_0}\\B\cos(\theta+\varphi_2)&-\frac{B\sin(\theta+\varphi_2)}{L_0}\end{bmatrix}F_{pole}</script><p>注意，这里的·解算中，对于每个关节电机转矩的方向是顺时针为正，其他都是按照图上的方向的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Matrix&lt;<span class="type">float</span>, <span class="number">2</span>, <span class="number">2</span>&gt; trans;</span><br><span class="line"><span class="type">float</span>                      A = l1 * <span class="built_in">sin</span>(angle1 - angle2) / <span class="built_in">sin</span>(angle2 - angle3);</span><br><span class="line"><span class="type">float</span>                      B = l4 * <span class="built_in">sin</span>(angle3 - angle4) / <span class="built_in">sin</span>(angle2 - angle3);</span><br><span class="line">trans &lt;&lt; -A * <span class="title function_">cos</span><span class="params">(theta.now + angle3)</span>, </span><br><span class="line">    A * <span class="title function_">sin</span><span class="params">(theta.now + angle3)</span> / L0.now, </span><br><span class="line">         -B * <span class="title function_">cos</span><span class="params">(theta.now + angle2)</span>, </span><br><span class="line">         B * <span class="title function_">sin</span><span class="params">(theta.now + angle2)</span> / L0.now;</span><br><span class="line"></span><br><span class="line">this-&gt;jointF-&gt;setTorque(-trans(<span class="number">0</span>, <span class="number">0</span>) * this-&gt;Fset - trans(<span class="number">0</span>, <span class="number">1</span>) * this-&gt;Tbset);</span><br><span class="line">this-&gt;jointB-&gt;setTorque(-trans(<span class="number">1</span>, <span class="number">0</span>) * this-&gt;Fset - trans(<span class="number">1</span>, <span class="number">1</span>) * this-&gt;Tbset);</span><br><span class="line">this-&gt;wheel-&gt;setTorque(this-&gt;Twset);</span><br></pre></td></tr></table></figure>
<h1 id="腿长控制"><a href="#腿长控制" class="headerlink" title="腿长控制"></a>腿长控制</h1><p>腿长控制是直接使用 PID 进行控制，但是一定要将控制腿长的 PID 调节的软一点，P 要小一点，D 要尽量小，I 尽量不给。</p>
<p>腿长 PID 较大会造成很大的影响，PID 过大导致系统的控制腿长的输出太大，相对应的控制整个系统的平衡的输出就很小，从而导致系统稳定性不够</p>
<p>例如：电机的输出的力矩是有限的，当把 LQR + VMC 解算出来的力矩同腿长控制 PID 的输出相结合之后，就会比较大，那么进行力矩限制时，会导致限制之后的力矩不能保证机体平衡或者腿长的控制，最终控制效果不好</p>
<h1 id="离地检测"><a href="#离地检测" class="headerlink" title="离地检测"></a>离地检测</h1><p><img src="/Blog_NexT/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/1710325439567.png" alt="1710325439567.png"></p>
<p>根据图中可以得到</p>
<script type="math/tex; mode=display">
m_w\ddot{z}_w=F_N-F\cos\theta+\frac{T_b\sin\theta}{L_0}</script><p>其中</p>
<script type="math/tex; mode=display">
z_w=z_b-L_0\cos\theta\\\\
\Downarrow\\\\
\ddot{z}_w=\ddot{z}_b-\ddot{L}_0\cos\theta+2\dot{L}_0\dot{\theta}\sin\theta+L_0\ddot{\theta}\sin\theta+L_0\dot{\theta}^2\cos\theta</script><p>并且其中的 $\ddot{z}_b$ 是机体重力加速度，可以通过机体上的传感器测得，但是需要结合机体姿态并且消去重力加速度得到</p>
<script type="math/tex; mode=display">
\ddot{z}_b=(a_z\cos\varphi+a_x\sin\varphi)\cos{\gamma}+a_y\sin\gamma</script><p>并且 $F$ 与 $T_b$ 都是根据关节电机反解出来的</p>
<script type="math/tex; mode=display">
(J^TRM)^{-1}T=F_{pole}</script><p>得到</p>
<script type="math/tex; mode=display">
F_N=m_w(\ddot{z}_b-\ddot{L}_0\cos\theta+2\dot{L}_0\dot{\theta}\sin\theta+L_0\ddot{\theta}\sin\theta+L_0\dot{\theta}^2\cos\theta)+F\cos\theta-\frac{T_b\sin\theta}{L_0}</script><p>可以判断，当 $F_N$ 小于某个阈值，就认为地面给的摩擦力不足以支持机体平衡，也就是处于腾空状态，此时，就只保持腿部姿态角即可，也就是除了 $\theta,\dot\theta$ 之外的数据的系数均为 0 即可</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> A = l1 * <span class="built_in">sin</span>(angle1 - angle2) / <span class="built_in">sin</span>(angle2 - angle3);</span><br><span class="line"><span class="type">float</span> B = l4 * <span class="built_in">sin</span>(angle3 - angle4) / <span class="built_in">sin</span>(angle2 - angle3);</span><br><span class="line">A       = A * <span class="built_in">cos</span>(angle2 + theta.now) * <span class="built_in">sin</span>(angle3 + theta.now) - A * <span class="built_in">cos</span>(angle3 + theta.now) * <span class="built_in">sin</span>(angle2 + theta.now);</span><br><span class="line">B       = B * <span class="built_in">cos</span>(angle2 + theta.now) * <span class="built_in">sin</span>(angle3 + theta.now) - B * <span class="built_in">cos</span>(angle3 + theta.now) * <span class="built_in">sin</span>(angle2 + theta.now);</span><br><span class="line"></span><br><span class="line">Eigen::Matrix&lt;<span class="type">float</span>, <span class="number">2</span>, <span class="number">2</span>&gt; trans;</span><br><span class="line">trans &lt;&lt; <span class="built_in">sin</span>(angle2 + theta.now) / A, -<span class="built_in">sin</span>(angle3 + theta.now) / B, L0.now * <span class="title function_">cos</span><span class="params">(angle2 + theta.now)</span> / B, -L0.now * <span class="title function_">cos</span><span class="params">(angle3 + theta.now)</span> / B;</span><br><span class="line"></span><br><span class="line">Fnow  = -trans(<span class="number">0</span>, <span class="number">0</span>) * jointF-&gt;torqueRead - trans(<span class="number">0</span>, <span class="number">1</span>) * jointB-&gt;torqueRead;</span><br><span class="line">Tbnow = -trans(<span class="number">1</span>, <span class="number">0</span>) * jointF-&gt;torqueRead - trans(<span class="number">1</span>, <span class="number">1</span>) * jointB-&gt;torqueRead;</span><br></pre></td></tr></table></figure>
<p>最终得到</p>
<script type="math/tex; mode=display">
F_N = \frac{F_{l,now} + F_{r,now}}{2}</script><h1 id="跳跃"><a href="#跳跃" class="headerlink" title="跳跃"></a>跳跃</h1><p>有些轮腿的控制中，是直接给一个比较大的力矩来使得机体跳跃，但是这样的话感觉并不是很好。所以有另一种方法：通过设定腿部杆长伸腿和蹬腿来实现跳跃</p>
<p>具体的腿部运动流程就是：收腿 <script type="math/tex">\rightarrow</script> 蹬腿 <script type="math/tex">\rightarrow</script></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(jump_process) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">        leg_len_l_set = min_leg_len;</span><br><span class="line">        leg_len_r_set = min_leg_len;</span><br><span class="line">        <span class="keyword">if</span>(fabsf(leg_len_l_set - min_leg_len) &lt; <span class="number">0.01f</span> &amp;&amp; fabsf(leg_len_r_set - min_leg_len) &lt; <span class="number">0.01f</span>)</span><br><span class="line">            ++jump_process;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        leg_len_l_set = max_leg_len;</span><br><span class="line">        leg_len_r_set = max_leg_len;</span><br><span class="line">        <span class="keyword">if</span>(fabsf(leg_len_l_set - max_leg_len) &lt; <span class="number">0.01f</span> &amp;&amp; fabsf(leg_len_r_set - max_leg_len) &lt; <span class="number">0.01f</span>)</span><br><span class="line">            ++jump_process;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        leg_len_l_set = min_leg_len;</span><br><span class="line">        leg_len_r_set = min_leg_len;</span><br><span class="line">        <span class="keyword">if</span>(fabsf(leg_len_l_set - min_leg_len) &lt; <span class="number">0.01f</span> &amp;&amp; fabsf(leg_len_r_set - min_leg_len) &lt; <span class="number">0.01f</span>)</span><br><span class="line">            ++jump_process;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        leg_len_l_set = buffer_leg_len;</span><br><span class="line">        leg_len_r_set = buffer_leg_len;</span><br><span class="line">        <span class="keyword">if</span>(fabsf(leg_len_l_set - buffer_leg_len) &lt; <span class="number">0.01f</span> &amp;&amp; fabsf(leg_len_r_set - buffer_leg_len) &lt; <span class="number">0.01f</span>)</span><br><span class="line">            ++jump_process;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">// nothing</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="转角控制"><a href="#转角控制" class="headerlink" title="转角控制"></a>转角控制</h1><p>转角可以直接利用 PID 进行控制，可以实现比较准确的控制，但是一般来说，这个 PID 的参数应当是一个 PD 控制器，这会保证系统不会因为卡住而出现大电流</p>
<h1 id="横滚角控制"><a href="#横滚角控制" class="headerlink" title="横滚角控制"></a>横滚角控制</h1><p>直接根据当前的横滚角，计算当机体保持平衡的时候两条腿的长度之差，然后叠加在当前腿长上</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> leg_dif = <span class="built_in">sin</span>(roll) * l_body;</span><br><span class="line">leg_len_l_set -= leg_dir / <span class="number">2</span>;</span><br><span class="line">leg_len_r_set += leg_dir / <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>整个控制系统是断断续续的研究了很久才能实现，这个机器人的控制确实很难，对于菜鸟的我来说确实很痛苦，但是研究出来之后会发现，原来当时困扰自己的东西只是一些小问题</p>
<p>实际上是做了两代轮腿，第一代死于经验不足，调试了差不多一个月然后被去安排做其他事情了。然后第二代轮腿实际上只在 4 天就成功了（喜极而泣），其实就是因为对其原理的理解不够清晰（一直觉得是机械结构设计不好，其实应该是我的问题）</p>
<p>再者即使调不出来也别放弃，重新整理一下思路，总会发现不一样的东西的</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>落
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://luo25177.github.io/2024/03/18/%E5%8F%8C%E8%BD%AE%E8%B6%B3%E5%BC%8F%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/" title="双轮足式机器人控制器设计">https://luo25177.github.io/2024/03/18/双轮足式机器人控制器设计/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/Blog_NexT/tags/LQR/" rel="tag"># LQR</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Blog_NexT/2024/03/18/MPC%E6%A8%A1%E5%9E%8B%E9%A2%84%E6%B5%8B%E6%8E%A7%E5%88%B6/" rel="prev" title="MPC模型预测控制">
      <i class="fa fa-chevron-left"></i> MPC模型预测控制
    </a></div>
      <div class="post-nav-item">
    <a href="/Blog_NexT/2024/03/18/git/" rel="next" title="git">
      git <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%95%E4%BE%A7%E7%B3%BB%E7%BB%9F%E7%8A%B6%E6%80%81%E6%96%B9%E7%A8%8B%E6%B1%82%E8%A7%A3"><span class="nav-number">1.</span> <span class="nav-text">单侧系统状态方程求解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AE%E5%AD%90"><span class="nav-number">1.1.</span> <span class="nav-text">轮子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%91%86%E6%9D%86"><span class="nav-number">1.2.</span> <span class="nav-text">摆杆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%BA%E4%BD%93"><span class="nav-number">1.3.</span> <span class="nav-text">机体</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1"><span class="nav-number">2.</span> <span class="nav-text">控制器设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#LQR-%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">2.1.</span> <span class="nav-text">LQR 控制器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hinfinty-%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">2.2.</span> <span class="nav-text">Hinfinty 控制器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E9%98%B6-LADRC"><span class="nav-number">2.3.</span> <span class="nav-text">二阶 LADRC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LTD"><span class="nav-number">2.3.1.</span> <span class="nav-text">LTD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LESO"><span class="nav-number">2.3.2.</span> <span class="nav-text">LESO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LSEF"><span class="nav-number">2.3.3.</span> <span class="nav-text">LSEF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.3.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E9%98%B6-LADRC"><span class="nav-number">2.4.</span> <span class="nav-text">三阶 LADRC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LTD-1"><span class="nav-number">2.4.1.</span> <span class="nav-text">LTD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LESO-1"><span class="nav-number">2.4.2.</span> <span class="nav-text">LESO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LSEF-1"><span class="nav-number">2.4.3.</span> <span class="nav-text">LSEF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-1"><span class="nav-number">2.4.4.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B4%E4%BD%93%E7%8A%B6%E6%80%81%E7%A9%BA%E9%97%B4%E6%96%B9%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text">整体状态空间方程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AE%E5%AD%90-1"><span class="nav-number">3.1.</span> <span class="nav-text">轮子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%91%86%E6%9D%86-1"><span class="nav-number">3.2.</span> <span class="nav-text">摆杆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%BA%E4%BD%93-1"><span class="nav-number">3.3.</span> <span class="nav-text">机体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E8%BD%A6%E7%9A%84%E8%88%AA%E5%90%91%E8%A7%92"><span class="nav-number">3.4.</span> <span class="nav-text">整车的航向角</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1-1"><span class="nav-number">4.</span> <span class="nav-text">控制器设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#LQR-%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1"><span class="nav-number">4.1.</span> <span class="nav-text">LQR 控制器设计</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E5%B0%8F%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">控制器小结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8A%E8%BA%AB%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">5.1.</span> <span class="nav-text">半身控制器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E8%BA%AB%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">5.2.</span> <span class="nav-text">全身控制器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%94%E8%BE%83"><span class="nav-number">5.3.</span> <span class="nav-text">比较</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E8%BF%9E%E6%9D%86%E6%AD%A3%E8%BF%90%E5%8A%A8%E5%AD%A6%E8%A7%A3%E7%AE%97"><span class="nav-number">6.</span> <span class="nav-text">五连杆正运动学解算</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#VMC"><span class="nav-number">7.</span> <span class="nav-text">VMC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%85%BF%E9%95%BF%E6%8E%A7%E5%88%B6"><span class="nav-number">8.</span> <span class="nav-text">腿长控制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%A6%BB%E5%9C%B0%E6%A3%80%E6%B5%8B"><span class="nav-number">9.</span> <span class="nav-text">离地检测</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B7%B3%E8%B7%83"><span class="nav-number">10.</span> <span class="nav-text">跳跃</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BD%AC%E8%A7%92%E6%8E%A7%E5%88%B6"><span class="nav-number">11.</span> <span class="nav-text">转角控制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%AA%E6%BB%9A%E8%A7%92%E6%8E%A7%E5%88%B6"><span class="nav-number">12.</span> <span class="nav-text">横滚角控制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">13.</span> <span class="nav-text">后记</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="落"
      src="/Blog_NexT/images/avatar.png">
  <p class="site-author-name" itemprop="name">落</p>
  <div class="site-description" itemprop="description">茶凉言尽，月上柳梢</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/Blog_NexT/archives/">
        
          <span class="site-state-item-count">112</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/Blog_NexT/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/Blog_NexT/tags/">
          
        <span class="site-state-item-count">103</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Luo25177" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Luo25177" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:beloved25177@126.com" title="E-Mail → mailto:beloved25177@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2024 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">落</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.2m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">18:03</span>
  <img src="https://gcore.jsdelivr.net/gh/CNhuazhu/TuChuang4/blog/备案图标.png">
  <a href="http://www.beian.miit.gov.cn/" target="_blank">豫ICP备2024056598号-1</a>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/Blog_NexT/lib/anime.min.js"></script>
  <script src="/Blog_NexT/lib/velocity/velocity.min.js"></script>
  <script src="/Blog_NexT/lib/velocity/velocity.ui.min.js"></script>

<script src="/Blog_NexT/js/utils.js"></script>

<script src="/Blog_NexT/js/motion.js"></script>


<script src="/Blog_NexT/js/schemes/pisces.js"></script>


<script src="/Blog_NexT/js/next-boot.js"></script>




  




  
<script src="/Blog_NexT/js/local-search.js"></script>













  

  
      
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css">
  <script src="//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css">


  

</body>
</html>
